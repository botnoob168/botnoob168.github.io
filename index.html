<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏´‡∏°‡∏≤‡πÅ‡∏°‡∏ß - ‡∏ï‡∏•‡∏≤‡∏î</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" integrity="sha512-r22gChDnGvBylk90+2e/ycr3RVrDi8DIOkIGNhJlKfuyQM4tIRAI062MaV8sfjQKYVGjOBaZBOA87z+IhZE9DA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            position: relative;
        }
        
        .gradient-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='4'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            animation: backgroundMove 40s linear infinite;
        }
        
        @keyframes backgroundMove {
            0% { transform: translateX(0) translateY(0); }
            100% { transform: translateX(-30px) translateY(-30px); }
        }
        
        .card-hover {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        
        .floating-animation {
            animation: float 8s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-15px) rotate(5deg); }
            50% { transform: translateY(-10px) rotate(0deg); }
            75% { transform: translateY(-20px) rotate(-5deg); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .pet-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
            position: relative;
            overflow: hidden;
        }
        
        .pet-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .pet-card:hover::before {
            left: 100%;
        }
        
        .input-focus {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .input-focus:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1), 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .sparkle {
            animation: sparkle 4s ease-in-out infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.05); }
        }
        
        .rainbow-text {
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .export-btn {
            background: linear-gradient(45deg, #00c851, #007e33);
            position: relative;
            overflow: hidden;
        }
        
        .export-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.3s;
        }
        
        .export-btn:hover::before {
            left: 100%;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Decorative Elements -->
    <div class="fixed top-10 left-10 text-6xl opacity-20 floating-animation">üêï</div>
    <div class="fixed top-32 right-20 text-4xl opacity-20 floating-animation" style="animation-delay: -2s;">üê±</div>
    <div class="fixed bottom-20 left-20 text-5xl opacity-20 floating-animation" style="animation-delay: -4s;">ü¶¥</div>
    <div class="fixed bottom-32 right-10 text-3xl opacity-20 floating-animation" style="animation-delay: -1s;">üêæ</div>

    <div class="container mx-auto px-4 py-8 relative z-10">
        <!-- Header -->
        <div class="text-center mb-12">
            <div class="inline-block glass-effect rounded-3xl px-8 py-6 mb-6">
                <h1 class="text-6xl font-extrabold text-white mb-3 drop-shadow-2xl rainbow-text">
                    üêïüê± ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏´‡∏°‡∏≤‡πÅ‡∏°‡∏ß
                </h1>
                <p class="text-white/90 text-xl font-semibold drop-shadow-lg">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏•‡∏≤‡∏î - ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</p>
                <div class="mt-4 flex justify-center space-x-4">
                    <span class="sparkle text-2xl">‚ú®</span>
                    <span class="sparkle text-2xl" style="animation-delay: 0.5s;">‚≠ê</span>
                    <span class="sparkle text-2xl" style="animation-delay: 1s;">üí´</span>
                </div>
            </div>
            
            <!-- Connection Status & Export Button -->
            <div class="mb-6 space-y-4">
                <div class="flex justify-center">
                    <div id="connectionStatus" class="text-sm font-medium bg-yellow-50 px-3 py-1 rounded-full border border-yellow-200">
                        <span class="text-yellow-600">üü° ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</span>
                    </div>
                </div>
                
                <div id="syncStatus" class="text-center" style="display: none;"></div>
                
                <div class="flex justify-center space-x-4 flex-wrap gap-4">
                    <button id="exportBtn" class="export-btn text-white px-8 py-4 rounded-2xl font-bold text-lg shadow-2xl hover:shadow-3xl transform hover:scale-105 transition-all duration-300">
                        <span class="flex items-center justify-center">
                            <span class="mr-3 text-2xl">üìä</span>
                            ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Excel
                        </span>
                    </button>
                    
                    <button id="setupBtn" class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-8 py-4 rounded-2xl font-bold text-lg shadow-2xl hover:shadow-3xl transform hover:scale-105 transition-all duration-300">
                        <span class="flex items-center justify-center">
                            <span class="mr-3 text-2xl">‚öôÔ∏è</span>
                            ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets
                        </span>
                    </button>
                    
                    <button id="firebaseBtn" class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-8 py-4 rounded-2xl font-bold text-lg shadow-2xl hover:shadow-3xl transform hover:scale-105 transition-all duration-300">
                        <span class="flex items-center justify-center">
                            <span class="mr-3 text-2xl">üî•</span>
                            ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Registration Form -->
            <div class="bg-white/95 backdrop-blur-sm rounded-3xl shadow-2xl p-8 card-hover">
                <div class="flex items-center justify-center mb-8">
                    <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-full p-4 mr-4">
                        <span class="text-3xl">üìù</span>
                    </div>
                    <h2 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                        ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà
                    </h2>
                </div>
                
                <form id="petForm" class="space-y-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="relative">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">üë§ ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á *</label>
                            <input type="text" id="ownerName" required 
                                   class="w-full px-5 py-4 border-2 border-gray-200 rounded-2xl input-focus focus:border-purple-500 focus:ring-0 text-gray-800 font-medium">
                        </div>
                        <div class="relative">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ *</label>
                            <input type="tel" id="ownerPhone" required 
                                   class="w-full px-5 py-4 border-2 border-gray-200 rounded-2xl input-focus focus:border-purple-500 focus:ring-0 text-gray-800 font-medium">
                        </div>
                    </div>

                    <div class="relative">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">üè™ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤/‡πÅ‡∏ú‡∏á</label>
                        <input type="text" id="shopName" 
                               class="w-full px-5 py-4 border-2 border-gray-200 rounded-2xl input-focus focus:border-purple-500 focus:ring-0 text-gray-800 font-medium">
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="relative">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">üêæ ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á *</label>
                            <input type="text" id="petName" required 
                                   class="w-full px-5 py-4 border-2 border-gray-200 rounded-2xl input-focus focus:border-purple-500 focus:ring-0 text-gray-800 font-medium">
                        </div>
                        <div class="relative">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">üè∑Ô∏è ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó *</label>
                            <select id="petType" required 
                                    class="w-full px-5 py-4 border-2 border-gray-200 rounded-2xl input-focus focus:border-purple-500 focus:ring-0 text-gray-800 font-medium">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                <option value="‡∏´‡∏°‡∏≤">üêï ‡∏´‡∏°‡∏≤</option>
                                <option value="‡πÅ‡∏°‡∏ß">üê± ‡πÅ‡∏°‡∏ß</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="relative">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">üß¨ ‡∏™‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</label>
                            <input type="text" id="petBreed" 
                                   class="w-full px-5 py-4 border-2 border-gray-200 rounded-2xl input-focus focus:border-purple-500 focus:ring-0 text-gray-800 font-medium">
                        </div>
                        <div class="relative">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">üé® ‡∏™‡∏µ</label>
                            <input type="text" id="petColor" 
                                   class="w-full px-5 py-4 border-2 border-gray-200 rounded-2xl input-focus focus:border-purple-500 focus:ring-0 text-gray-800 font-medium">
                        </div>
                    </div>

                    <!-- Pet Photo Upload Section -->
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 border-2 border-purple-200">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üì∏</span>
                            ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á
                        </h3>
                        
                        <div class="space-y-4">
                            <!-- Upload Area -->
                            <div class="relative">
                                <input type="file" id="petPhoto" accept="image/*" capture="environment" 
                                       class="hidden" onchange="handlePhotoUpload(this)">
                                <div id="uploadArea" onclick="document.getElementById('petPhoto').click()" 
                                     class="border-2 border-dashed border-purple-300 rounded-2xl p-8 text-center cursor-pointer hover:border-purple-500 hover:bg-purple-50 transition-all duration-300">
                                    <div class="text-6xl mb-4">üì∑</div>
                                    <div class="text-lg font-semibold text-gray-700 mb-2">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</div>
                                    <div class="text-sm text-gray-500">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå JPG, PNG, WEBP (‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB)</div>
                                </div>
                            </div>
                            
                            <!-- Photo Preview -->
                            <div id="photoPreview" class="hidden">
                                <div class="relative inline-block">
                                    <img id="previewImage" src="" alt="Pet Photo" 
                                         class="w-32 h-32 object-cover rounded-2xl border-4 border-white shadow-lg">
                                    <button type="button" onclick="removePhoto()" 
                                            class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-600 transition-colors">
                                        ‚úï
                                    </button>
                                </div>
                                <div class="mt-2 text-sm text-gray-600">
                                    <span id="photoInfo"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Vaccination Section -->
                    <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-2xl p-6 border-2 border-green-200">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üíâ</span>
                            ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="relative">
                                <label class="block text-sm font-semibold text-gray-700 mb-3">ü¶† ‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏û‡∏¥‡∏©‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏ö‡πâ‡∏≤</label>
                                <select id="rabiesVaccine" 
                                        class="w-full px-5 py-4 border-2 border-gray-200 rounded-2xl input-focus focus:border-green-500 focus:ring-0 text-gray-800 font-medium">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                                    <option value="‡∏â‡∏µ‡∏î‡πÅ‡∏•‡πâ‡∏ß">‚úÖ ‡∏â‡∏µ‡∏î‡πÅ‡∏•‡πâ‡∏ß</option>
                                    <option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏â‡∏µ‡∏î">‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏â‡∏µ‡∏î</option>
                                    <option value="‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö">‚ùì ‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö</option>
                                </select>
                            </div>
                            <div class="relative">
                                <label class="block text-sm font-semibold text-gray-700 mb-3">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</label>
                                <input type="date" id="vaccineDate" 
                                       class="w-full px-5 py-4 border-2 border-gray-200 rounded-2xl input-focus focus:border-green-500 focus:ring-0 text-gray-800 font-medium">
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-6 mt-4">
                            <div class="relative">
                                <label class="block text-sm font-semibold text-gray-700 mb-3">üè• ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î</label>
                                <input type="text" id="vaccineLocation" 
                                       placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå, ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å"
                                       class="w-full px-5 py-4 border-2 border-gray-200 rounded-2xl input-focus focus:border-green-500 focus:ring-0 text-gray-800 font-medium">
                            </div>
                            <div class="relative">
                                <label class="block text-sm font-semibold text-gray-700 mb-3">üíä ‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
                                <input type="text" id="otherVaccines" 
                                       placeholder="‡πÄ‡∏ä‡πà‡∏ô 5 in 1, 7 in 1"
                                       class="w-full px-5 py-4 border-2 border-gray-200 rounded-2xl input-focus focus:border-green-500 focus:ring-0 text-gray-800 font-medium">
                            </div>
                        </div>
                    </div>

                    <div class="relative">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">‚ú® ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏©</label>
                        <textarea id="petDescription" rows="4" 
                                  class="w-full px-5 py-4 border-2 border-gray-200 rounded-2xl input-focus focus:border-purple-500 focus:ring-0 text-gray-800 font-medium resize-none"
                                  placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏î‡∏≥‡∏ó‡∏µ‡πà‡∏´‡∏π, ‡∏Ç‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß, ‡∏°‡∏µ‡∏£‡∏≠‡∏¢‡πÅ‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô ‡∏Ø‡∏•‡∏Ø"></textarea>
                    </div>

                    <button type="submit" 
                            class="w-full bg-gradient-to-r from-purple-600 via-pink-600 to-red-500 text-white py-4 px-8 rounded-2xl font-bold text-lg hover:from-purple-700 hover:via-pink-700 hover:to-red-600 transform hover:scale-105 transition-all duration-300 shadow-xl hover:shadow-2xl">
                        <span class="flex items-center justify-center">
                            <span class="mr-2">‚úÖ</span>
                            ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏•‡∏¢!
                        </span>
                    </button>
                </form>
            </div>

            <!-- Pet List -->
            <div class="bg-white/95 backdrop-blur-sm rounded-3xl shadow-2xl p-8 card-hover">
                <div class="flex justify-between items-center mb-8">
                    <div class="flex items-center">
                        <div class="bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full p-4 mr-4">
                            <span class="text-3xl">üìã</span>
                        </div>
                        <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent">
                            ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á
                        </h2>
                    </div>
                    <div class="bg-gradient-to-r from-green-400 to-blue-500 text-white px-6 py-3 rounded-2xl shadow-lg">
                        <div class="text-sm font-medium">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div class="text-2xl font-bold text-center" id="totalCount">0</div>
                        <div class="text-sm font-medium">‡∏ï‡∏±‡∏ß</div>
                    </div>
                </div>

                <!-- Search -->
                <div class="mb-6 relative">
                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                        <span class="text-2xl">üîç</span>
                    </div>
                    <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á, ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå, ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤..." 
                           class="w-full pl-16 pr-5 py-4 border-2 border-gray-200 rounded-2xl input-focus focus:border-blue-500 focus:ring-0 text-gray-800 font-medium">
                </div>

                <!-- Filter -->
                <div class="mb-6">
                    <select id="typeFilter" class="px-5 py-3 border-2 border-gray-200 rounded-2xl input-focus focus:border-blue-500 focus:ring-0 text-gray-800 font-medium">
                        <option value="">üåü ‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                        <option value="‡∏´‡∏°‡∏≤">üêï ‡∏´‡∏°‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</option>
                        <option value="‡πÅ‡∏°‡∏ß">üê± ‡πÅ‡∏°‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</option>
                    </select>
                </div>

                <!-- Pet List -->
                <div id="petList" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                    <div class="text-center text-gray-500 py-12">
                        <div class="text-6xl mb-4 opacity-50">üêæ</div>
                        <div class="text-lg font-medium">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</div>
                        <div class="text-sm">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Google Sheets Configuration
        const GOOGLE_SHEETS_CONFIG = {
            scriptUrl: '', // ‡∏à‡∏∞‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Apps Script ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            sheetId: '',   // ‡∏à‡∏∞‡πÉ‡∏™‡πà ID ‡∏Ç‡∏≠‡∏á Google Sheets ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            enabled: false // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô true ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à
        };

        // Firebase Configuration - ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏¢‡∏≤‡∏ß
        const FIREBASE_CONFIG = {
            apiKey: "",
            authDomain: "",
            projectId: "",
            storageBucket: "",
            messagingSenderId: "",
            appId: "",
            enabled: false,
            autoRetry: true,
            maxRetries: 3,
            retryDelay: 2000
        };

        let firebaseApp = null;
        let firestore = null;
        let firebaseInitialized = false;
        let connectionRetries = 0;

        let pets = JSON.parse(localStorage.getItem('marketPets')) || [];
        let petIdCounter = parseInt(localStorage.getItem('petIdCounter')) || 1;
        let isOnline = navigator.onLine;
        let syncQueue = JSON.parse(localStorage.getItem('syncQueue')) || [];
        let currentPetPhoto = null;

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï
        window.addEventListener('online', () => {
            isOnline = true;
            updateConnectionStatus();
            syncWithGoogleSheets();
        });

        window.addEventListener('offline', () => {
            isOnline = false;
            updateConnectionStatus();
        });

        // Firebase Functions - ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á
        async function initializeFirebase() {
            if (!FIREBASE_CONFIG.enabled || firebaseInitialized) return firebaseInitialized;
            
            try {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Firebase SDK ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
                if (typeof firebase === 'undefined') {
                    console.warn('Firebase SDK not loaded yet, retrying...');
                    if (connectionRetries < FIREBASE_CONFIG.maxRetries) {
                        connectionRetries++;
                        setTimeout(() => initializeFirebase(), FIREBASE_CONFIG.retryDelay);
                    }
                    return false;
                }

                // ‡∏•‡∏ö app ‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡∏°‡∏µ (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô duplicate app error)
                try {
                    const existingApp = firebase.app('pet-registration');
                    await existingApp.delete();
                } catch (e) {
                    // ‡πÑ‡∏°‡πà‡∏°‡∏µ app ‡πÄ‡∏î‡∏¥‡∏° ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£
                }

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Firebase app ‡πÉ‡∏´‡∏°‡πà
                firebaseApp = firebase.initializeApp(FIREBASE_CONFIG, 'pet-registration');
                firestore = firebase.firestore(firebaseApp);
                
                // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firestore settings ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
                firestore.settings({
                    cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED
                });

                // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                await testFirebaseConnection();
                
                firebaseInitialized = true;
                connectionRetries = 0;
                console.log('Firebase initialized successfully');
                
                // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ offline persistence
                try {
                    await firestore.enablePersistence({ synchronizeTabs: true });
                    console.log('Firebase offline persistence enabled');
                } catch (err) {
                    if (err.code === 'failed-precondition') {
                        console.warn('Multiple tabs open, persistence can only be enabled in one tab at a time');
                    } else if (err.code === 'unimplemented') {
                        console.warn('Browser doesn\'t support persistence');
                    }
                }
                
                return true;
            } catch (error) {
                console.error('Firebase initialization error:', error);
                firebaseInitialized = false;
                
                // Auto retry
                if (FIREBASE_CONFIG.autoRetry && connectionRetries < FIREBASE_CONFIG.maxRetries) {
                    connectionRetries++;
                    console.log(`Retrying Firebase initialization (${connectionRetries}/${FIREBASE_CONFIG.maxRetries})...`);
                    setTimeout(() => initializeFirebase(), FIREBASE_CONFIG.retryDelay);
                }
                
                return false;
            }
        }

        async function testFirebaseConnection() {
            if (!firestore) throw new Error('Firestore not initialized');
            
            const testDoc = firestore.collection('_health').doc('connection-test');
            await testDoc.set({
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'connected'
            });
            
            const doc = await testDoc.get();
            if (!doc.exists) {
                throw new Error('Connection test failed');
            }
            
            // ‡∏•‡∏ö test document
            await testDoc.delete();
        }

        async function saveToFirebase(petData, retryCount = 0) {
            if (!firestore || !firebaseInitialized) {
                if (retryCount < FIREBASE_CONFIG.maxRetries) {
                    await initializeFirebase();
                    return saveToFirebase(petData, retryCount + 1);
                }
                return false;
            }
            
            try {
                const docRef = firestore.collection('pets').doc(petData.id);
                await docRef.set({
                    ...petData,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    version: 1 // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö conflict resolution
                }, { merge: true });
                
                console.log(`Pet ${petData.id} saved to Firebase successfully`);
                return true;
            } catch (error) {
                console.error('Firebase save error:', error);
                
                // Auto retry ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö network errors
                if (error.code === 'unavailable' && retryCount < FIREBASE_CONFIG.maxRetries) {
                    console.log(`Retrying save operation (${retryCount + 1}/${FIREBASE_CONFIG.maxRetries})...`);
                    await new Promise(resolve => setTimeout(resolve, FIREBASE_CONFIG.retryDelay));
                    return saveToFirebase(petData, retryCount + 1);
                }
                
                return false;
            }
        }

        async function loadFromFirebase(retryCount = 0) {
            if (!firestore || !firebaseInitialized) {
                if (retryCount < FIREBASE_CONFIG.maxRetries) {
                    await initializeFirebase();
                    return loadFromFirebase(retryCount + 1);
                }
                return [];
            }
            
            try {
                // ‡πÉ‡∏ä‡πâ cache ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢ sync ‡∏à‡∏≤‡∏Å server
                const snapshot = await firestore.collection('pets')
                    .orderBy('createdAt', 'desc')
                    .get({ source: 'cache' });
                
                const firebasePets = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢
                    if (data && data.id && data.petName && data.ownerName) {
                        firebasePets.push({
                            ...data,
                            id: doc.id,
                            fromCache: snapshot.metadata.fromCache
                        });
                    }
                });
                
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å cache ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ sync ‡∏à‡∏≤‡∏Å server ‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
                if (snapshot.metadata.fromCache) {
                    firestore.collection('pets')
                        .orderBy('createdAt', 'desc')
                        .get({ source: 'server' })
                        .then(serverSnapshot => {
                            if (!serverSnapshot.metadata.fromCache) {
                                console.log('Firebase data synced from server');
                                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
                                const serverPets = [];
                                serverSnapshot.forEach(doc => {
                                    const data = doc.data();
                                    if (data && data.id && data.petName && data.ownerName) {
                                        serverPets.push({ ...data, id: doc.id });
                                    }
                                });
                                
                                // ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô
                                if (JSON.stringify(serverPets) !== JSON.stringify(firebasePets)) {
                                    console.log('Server data differs from cache, updating...');
                                    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
                                    updateLocalDataFromFirebase(serverPets);
                                }
                            }
                        })
                        .catch(error => console.warn('Background sync failed:', error));
                }
                
                console.log(`Loaded ${firebasePets.length} pets from Firebase`);
                return firebasePets;
            } catch (error) {
                console.error('Firebase load error:', error);
                
                // Auto retry ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö network errors
                if (error.code === 'unavailable' && retryCount < FIREBASE_CONFIG.maxRetries) {
                    console.log(`Retrying load operation (${retryCount + 1}/${FIREBASE_CONFIG.maxRetries})...`);
                    await new Promise(resolve => setTimeout(resolve, FIREBASE_CONFIG.retryDelay));
                    return loadFromFirebase(retryCount + 1);
                }
                
                return [];
            }
        }

        async function deleteFromFirebase(petId, retryCount = 0) {
            if (!firestore || !firebaseInitialized) {
                if (retryCount < FIREBASE_CONFIG.maxRetries) {
                    await initializeFirebase();
                    return deleteFromFirebase(petId, retryCount + 1);
                }
                return false;
            }
            
            try {
                await firestore.collection('pets').doc(petId).delete();
                console.log(`Pet ${petId} deleted from Firebase successfully`);
                return true;
            } catch (error) {
                console.error('Firebase delete error:', error);
                
                // Auto retry ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö network errors
                if (error.code === 'unavailable' && retryCount < FIREBASE_CONFIG.maxRetries) {
                    console.log(`Retrying delete operation (${retryCount + 1}/${FIREBASE_CONFIG.maxRetries})...`);
                    await new Promise(resolve => setTimeout(resolve, FIREBASE_CONFIG.retryDelay));
                    return deleteFromFirebase(petId, retryCount + 1);
                }
                
                return false;
            }
        }

        function updateLocalDataFromFirebase(firebasePets) {
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase
            const localPetIds = pets.map(pet => pet.id);
            const newPets = firebasePets.filter(pet => !localPetIds.includes(pet.id));
            
            if (newPets.length > 0) {
                pets = [...newPets, ...pets];
                savePets();
                renderPets();
                updateTotalCount();
                showSyncStatus(`‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase: ${newPets.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà`, 'success');
            }
        }

        // Real-time listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Firebase
        function setupFirebaseListener() {
            if (!firestore || !firebaseInitialized) return;
            
            try {
                const unsubscribe = firestore.collection('pets')
                    .orderBy('createdAt', 'desc')
                    .onSnapshot(
                        (snapshot) => {
                            console.log('Firebase real-time update received');
                            const firebasePets = [];
                            snapshot.forEach(doc => {
                                const data = doc.data();
                                if (data && data.id && data.petName && data.ownerName) {
                                    firebasePets.push({ ...data, id: doc.id });
                                }
                            });
                            
                            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ö‡∏ö real-time
                            updateLocalDataFromFirebase(firebasePets);
                        },
                        (error) => {
                            console.error('Firebase listener error:', error);
                            // ‡∏•‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ listener ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                            setTimeout(setupFirebaseListener, 5000);
                        }
                    );
                
                // ‡πÄ‡∏Å‡πá‡∏ö unsubscribe function ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á
                window.firebaseUnsubscribe = unsubscribe;
                console.log('Firebase real-time listener setup successfully');
            } catch (error) {
                console.error('Failed to setup Firebase listener:', error);
            }
        }

        function updateConnectionStatus() {
            const statusElement = document.getElementById('connectionStatus');
            
            if (isOnline && FIREBASE_CONFIG.enabled && firebaseInitialized) {
                statusElement.innerHTML = '<span class="text-green-600">üü¢ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase (Real-time)</span>';
                statusElement.className = 'text-sm font-medium bg-green-50 px-3 py-1 rounded-full border border-green-200';
            } else if (isOnline && FIREBASE_CONFIG.enabled && !firebaseInitialized) {
                statusElement.innerHTML = '<span class="text-orange-600">üü† ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase...</span>';
                statusElement.className = 'text-sm font-medium bg-orange-50 px-3 py-1 rounded-full border border-orange-200';
            } else if (isOnline && GOOGLE_SHEETS_CONFIG.enabled) {
                statusElement.innerHTML = '<span class="text-blue-600">üîµ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</span>';
                statusElement.className = 'text-sm font-medium bg-blue-50 px-3 py-1 rounded-full border border-blue-200';
            } else if (isOnline && !GOOGLE_SHEETS_CONFIG.enabled && !FIREBASE_CONFIG.enabled) {
                statusElement.innerHTML = '<span class="text-yellow-600">üü° ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)</span>';
                statusElement.className = 'text-sm font-medium bg-yellow-50 px-3 py-1 rounded-full border border-yellow-200';
            } else {
                statusElement.innerHTML = '<span class="text-red-600">üî¥ ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)</span>';
                statusElement.className = 'text-sm font-medium bg-red-50 px-3 py-1 rounded-full border border-red-200';
            }
        }

        async function syncWithGoogleSheets() {
            if (!GOOGLE_SHEETS_CONFIG.enabled || !isOnline || syncQueue.length === 0) return;

            try {
                showSyncStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
                
                for (const action of syncQueue) {
                    await sendToGoogleSheets(action);
                }
                
                // ‡∏•‡πâ‡∏≤‡∏á sync queue ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                syncQueue = [];
                localStorage.setItem('syncQueue', JSON.stringify(syncQueue));
                showSyncStatus('‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                
            } catch (error) {
                console.error('Sync error:', error);
                showSyncStatus('‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏à‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á', 'error');
            }
        }

        async function sendToGoogleSheets(data) {
            if (!GOOGLE_SHEETS_CONFIG.enabled || !GOOGLE_SHEETS_CONFIG.scriptUrl) {
                throw new Error('Google Sheets ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤');
            }

            const response = await fetch(GOOGLE_SHEETS_CONFIG.scriptUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            return await response.json();
        }

        function addToSyncQueue(action) {
            syncQueue.push({
                ...action,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('syncQueue', JSON.stringify(syncQueue));
            
            // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            if (isOnline && GOOGLE_SHEETS_CONFIG.enabled) {
                syncWithGoogleSheets();
            }
        }

        function showSyncStatus(message, type = 'info') {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.textContent = message;
            
            statusDiv.className = 'text-sm font-medium px-3 py-2 rounded-lg transition-all duration-300 ';
            
            switch(type) {
                case 'success':
                    statusDiv.className += 'bg-green-100 text-green-700 border border-green-200';
                    break;
                case 'error':
                    statusDiv.className += 'bg-red-100 text-red-700 border border-red-200';
                    break;
                default:
                    statusDiv.className += 'bg-blue-100 text-blue-700 border border-blue-200';
            }
            
            statusDiv.style.display = 'block';
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            }
        }

        function savePets() {
            localStorage.setItem('marketPets', JSON.stringify(pets));
            localStorage.setItem('petIdCounter', petIdCounter.toString());
        }

        // Photo handling functions
        function handlePhotoUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (JPG, PNG, WEBP) ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                input.value = '';
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå (5MB)
            const maxSize = 5 * 1024 * 1024;
            if (file.size > maxSize) {
                alert('‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB');
                input.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                // ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Å‡πá‡∏ö
                compressImage(e.target.result, 800, 0.8, function(compressedDataUrl) {
                    currentPetPhoto = compressedDataUrl;
                    showPhotoPreview(compressedDataUrl, file);
                });
            };
            reader.readAsDataURL(file);
        }
        
        function compressImage(dataUrl, maxWidth, quality, callback) {
            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà
                let { width, height } = img;
                if (width > maxWidth) {
                    height = (height * maxWidth) / width;
                    width = maxWidth;
                }
                
                canvas.width = width;
                canvas.height = height;
                
                // ‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏•‡∏á‡πÉ‡∏ô canvas
                ctx.drawImage(img, 0, 0, width, height);
                
                // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô data URL
                const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                callback(compressedDataUrl);
            };
            img.src = dataUrl;
        }
        
        function showPhotoPreview(dataUrl, file) {
            const uploadArea = document.getElementById('uploadArea');
            const photoPreview = document.getElementById('photoPreview');
            const previewImage = document.getElementById('previewImage');
            const photoInfo = document.getElementById('photoInfo');
            
            // ‡∏ã‡πà‡∏≠‡∏ô upload area ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á preview
            uploadArea.style.display = 'none';
            photoPreview.classList.remove('hidden');
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ
            previewImage.src = dataUrl;
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå
            const sizeKB = Math.round(file.size / 1024);
            photoInfo.textContent = `${file.name} (${sizeKB} KB)`;
        }
        
        function removePhoto() {
            const uploadArea = document.getElementById('uploadArea');
            const photoPreview = document.getElementById('photoPreview');
            const petPhotoInput = document.getElementById('petPhoto');
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤
            currentPetPhoto = null;
            petPhotoInput.value = '';
            
            // ‡πÅ‡∏™‡∏î‡∏á upload area ‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏ô preview
            uploadArea.style.display = 'block';
            photoPreview.classList.add('hidden');
        }

        function generatePetId() {
            const id = `PET${petIdCounter.toString().padStart(3, '0')}`;
            petIdCounter++;
            return id;
        }

        async function addPet(petData) {
            const pet = {
                id: generatePetId(),
                ...petData,
                registeredDate: new Date().toLocaleDateString('th-TH')
            };
            pets.unshift(pet);
            savePets();
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase ‡∏Å‡πà‡∏≠‡∏ô (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)
            if (FIREBASE_CONFIG.enabled) {
                try {
                    await saveToFirebase(pet);
                    showSyncStatus('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                } catch (error) {
                    console.error('Firebase save failed:', error);
                    showSyncStatus('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
                }
            }
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô Google Sheets sync queue (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)
            if (GOOGLE_SHEETS_CONFIG.enabled) {
                addToSyncQueue({
                    action: 'add',
                    data: pet
                });
            }
            
            renderPets();
            updateTotalCount();
        }

        async function deletePet(petId) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ?')) {
                const petToDelete = pets.find(pet => pet.id === petId);
                pets = pets.filter(pet => pet.id !== petId);
                savePets();
                
                // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å Firebase ‡∏Å‡πà‡∏≠‡∏ô (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)
                if (FIREBASE_CONFIG.enabled && petToDelete) {
                    try {
                        await deleteFromFirebase(petId);
                        showSyncStatus('‡∏•‡∏ö‡∏à‡∏≤‡∏Å Firebase ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    } catch (error) {
                        console.error('Firebase delete failed:', error);
                        showSyncStatus('‡∏•‡∏ö‡∏à‡∏≤‡∏Å Firebase ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
                    }
                }
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô Google Sheets sync queue (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)
                if (GOOGLE_SHEETS_CONFIG.enabled && petToDelete) {
                    addToSyncQueue({
                        action: 'delete',
                        data: { id: petId }
                    });
                }
                
                renderPets();
                updateTotalCount();
            }
        }

        function renderPets(petsToRender = pets) {
            const petList = document.getElementById('petList');
            
            if (petsToRender.length === 0) {
                petList.innerHTML = `
                    <div class="text-center text-gray-500 py-12">
                        <div class="text-6xl mb-4 opacity-50">üêæ</div>
                        <div class="text-lg font-medium">${pets.length === 0 ? '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á' : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤'}</div>
                        <div class="text-sm">${pets.length === 0 ? '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å' : '‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á'}</div>
                    </div>
                `;
                return;
            }

            petList.innerHTML = petsToRender.map(pet => `
                <div class="pet-card rounded-2xl p-6 card-hover border-l-4 ${pet.petType === '‡∏´‡∏°‡∏≤' ? 'border-l-blue-500' : 'border-l-pink-500'}">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center space-x-4">
                            ${pet.petPhoto ? `
                                <div class="relative">
                                    <img src="${pet.petPhoto}" alt="${pet.petName}" 
                                         class="w-16 h-16 object-cover rounded-full border-4 ${pet.petType === '‡∏´‡∏°‡∏≤' ? 'border-blue-200' : 'border-pink-200'} shadow-lg cursor-pointer hover:scale-110 transition-transform duration-300"
                                         onclick="showFullImage('${pet.petPhoto}', '${pet.petName}')">
                                    <div class="absolute -bottom-1 -right-1 text-lg ${pet.petType === '‡∏´‡∏°‡∏≤' ? 'bg-blue-100' : 'bg-pink-100'} rounded-full p-1">
                                        ${pet.petType === '‡∏´‡∏°‡∏≤' ? 'üêï' : 'üê±'}
                                    </div>
                                </div>
                            ` : `
                                <div class="text-4xl ${pet.petType === '‡∏´‡∏°‡∏≤' ? 'bg-blue-100' : 'bg-pink-100'} rounded-full p-3">
                                    ${pet.petType === '‡∏´‡∏°‡∏≤' ? 'üêï' : 'üê±'}
                                </div>
                            `}
                            <div>
                                <h3 class="font-bold text-xl text-gray-800 mb-1">${pet.petName}</h3>
                                <div class="flex items-center space-x-2">
                                    <span class="bg-gradient-to-r ${pet.petType === '‡∏´‡∏°‡∏≤' ? 'from-blue-500 to-blue-600' : 'from-pink-500 to-pink-600'} text-white px-3 py-1 rounded-full text-xs font-semibold">
                                        ${pet.id}
                                    </span>
                                    <span class="text-xs text-gray-500">${pet.registeredDate}</span>
                                </div>
                            </div>
                        </div>
                        <button onclick="deletePet('${pet.id}')" 
                                class="bg-red-100 hover:bg-red-200 text-red-600 hover:text-red-700 px-3 py-2 rounded-xl text-sm font-medium transition-all duration-200 hover:scale-105">
                            üóëÔ∏è ‡∏•‡∏ö
                        </button>
                    </div>
                    
                    <div class="bg-gray-50 rounded-xl p-4 mb-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                            <div class="flex items-center space-x-2">
                                <span class="text-blue-500">üë§</span>
                                <span class="font-semibold text-gray-700">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á:</span>
                                <span class="text-gray-800">${pet.ownerName}</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-green-500">üì±</span>
                                <span class="font-semibold text-gray-700">‡πÇ‡∏ó‡∏£:</span>
                                <span class="text-gray-800">${pet.ownerPhone}</span>
                            </div>
                            ${pet.shopName ? `
                                <div class="flex items-center space-x-2">
                                    <span class="text-purple-500">üè™</span>
                                    <span class="font-semibold text-gray-700">‡∏£‡πâ‡∏≤‡∏ô:</span>
                                    <span class="text-gray-800">${pet.shopName}</span>
                                </div>
                            ` : ''}
                            ${pet.petBreed ? `
                                <div class="flex items-center space-x-2">
                                    <span class="text-orange-500">üß¨</span>
                                    <span class="font-semibold text-gray-700">‡∏™‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå:</span>
                                    <span class="text-gray-800">${pet.petBreed}</span>
                                </div>
                            ` : ''}
                            ${pet.petColor ? `
                                <div class="flex items-center space-x-2">
                                    <span class="text-pink-500">üé®</span>
                                    <span class="font-semibold text-gray-700">‡∏™‡∏µ:</span>
                                    <span class="text-gray-800">${pet.petColor}</span>
                                </div>
                            ` : ''}
                            ${pet.rabiesVaccine ? `
                                <div class="flex items-center space-x-2">
                                    <span class="text-red-500">üíâ</span>
                                    <span class="font-semibold text-gray-700">‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏û‡∏¥‡∏©‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏ö‡πâ‡∏≤:</span>
                                    <span class="text-gray-800">${pet.rabiesVaccine}</span>
                                </div>
                            ` : ''}
                            ${pet.vaccineDate ? `
                                <div class="flex items-center space-x-2">
                                    <span class="text-blue-500">üìÖ</span>
                                    <span class="font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</span>
                                    <span class="text-gray-800">${new Date(pet.vaccineDate).toLocaleDateString('th-TH')}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <!-- Vaccine Info Section -->
                    ${(pet.vaccineLocation || pet.otherVaccines) ? `
                        <div class="bg-green-50 border-l-4 border-green-400 p-3 rounded-r-xl mb-3">
                            <div class="flex items-start space-x-2">
                                <span class="text-green-500 mt-0.5">üíâ</span>
                                <div class="w-full">
                                    <span class="font-semibold text-gray-700 text-sm">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</span>
                                    ${pet.vaccineLocation ? `<p class="text-gray-800 text-sm mt-1">üè• ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î: ${pet.vaccineLocation}</p>` : ''}
                                    ${pet.otherVaccines ? `<p class="text-gray-800 text-sm mt-1">üíä ‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ: ${pet.otherVaccines}</p>` : ''}
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    ${pet.petDescription ? `
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 rounded-r-xl">
                            <div class="flex items-start space-x-2">
                                <span class="text-yellow-500 mt-0.5">‚ú®</span>
                                <div>
                                    <span class="font-semibold text-gray-700 text-sm">‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏©:</span>
                                    <p class="text-gray-800 text-sm mt-1">${pet.petDescription}</p>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function updateTotalCount() {
            const countElement = document.getElementById('totalCount');
            countElement.textContent = pets.length;
            countElement.classList.add('pulse-animation');
            setTimeout(() => {
                countElement.classList.remove('pulse-animation');
            }, 1000);
        }

        function filterPets() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            
            let filteredPets = pets.filter(pet => {
                const matchesSearch = !searchTerm || 
                    pet.ownerName.toLowerCase().includes(searchTerm) ||
                    pet.petName.toLowerCase().includes(searchTerm) ||
                    (pet.shopName && pet.shopName.toLowerCase().includes(searchTerm)) ||
                    pet.id.toLowerCase().includes(searchTerm);
                
                const matchesType = !typeFilter || pet.petType === typeFilter;
                
                return matchesSearch && matchesType;
            });
            
            renderPets(filteredPets);
        }

        function exportToExcel() {
            if (pets.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å');
                return;
            }

            try {
                // Check if XLSX is loaded
                if (typeof XLSX === 'undefined') {
                    alert('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ Excel ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
                    return;
                }

                // Prepare data for Excel
                const excelData = pets.map((pet, index) => ({
                    '‡∏•‡∏≥‡∏î‡∏±‡∏ö': index + 1,
                    '‡∏£‡∏´‡∏±‡∏™‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á': pet.id,
                    '‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á': pet.petName,
                    '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó': pet.petType,
                    '‡∏™‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå': pet.petBreed || '-',
                    '‡∏™‡∏µ': pet.petColor || '-',
                    '‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á': pet.ownerName,
                    '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£': pet.ownerPhone,
                    '‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤/‡πÅ‡∏ú‡∏á': pet.shopName || '-',
                    '‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏û‡∏¥‡∏©‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏ö‡πâ‡∏≤': pet.rabiesVaccine || '-',
                    '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô': pet.vaccineDate ? new Date(pet.vaccineDate).toLocaleDateString('th-TH') : '-',
                    '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô': pet.vaccineLocation || '-',
                    '‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ': pet.otherVaccines || '-',
                    '‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏©': pet.petDescription || '-',
                    '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô': pet.registeredDate
                }));

                // Create workbook and worksheet
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(excelData);

                // Set column widths
                const colWidths = [
                    { wch: 8 },   // ‡∏•‡∏≥‡∏î‡∏±‡∏ö
                    { wch: 15 },  // ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á
                    { wch: 20 },  // ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á
                    { wch: 10 },  // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
                    { wch: 15 },  // ‡∏™‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå
                    { wch: 15 },  // ‡∏™‡∏µ
                    { wch: 25 },  // ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á
                    { wch: 15 },  // ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£
                    { wch: 20 },  // ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤/‡πÅ‡∏ú‡∏á
                    { wch: 18 },  // ‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏û‡∏¥‡∏©‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏ö‡πâ‡∏≤
                    { wch: 18 },  // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô
                    { wch: 20 },  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô
                    { wch: 18 },  // ‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                    { wch: 30 },  // ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏©
                    { wch: 15 }   // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
                ];
                ws['!cols'] = colWidths;

                // Add worksheet to workbook
                XLSX.utils.book_append_sheet(wb, ws, '‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á');

                // Generate filename with current date
                const now = new Date();
                const day = now.getDate().toString().padStart(2, '0');
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const year = (now.getFullYear() + 543).toString(); // Convert to Buddhist year
                const dateStr = `${day}-${month}-${year}`;
                const filename = `‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á_${dateStr}.xlsx`;

                // Save file
                XLSX.writeFile(wb, filename);

                // Show success message
                const exportBtn = document.getElementById('exportBtn');
                const originalText = exportBtn.innerHTML;
                exportBtn.innerHTML = '<span class="flex items-center justify-center"><span class="mr-3 text-2xl">‚úÖ</span>‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</span>';
                setTimeout(() => {
                    exportBtn.innerHTML = originalText;
                }, 3000);

            } catch (error) {
                console.error('Export error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            }
        }

        // Event Listeners
        document.getElementById('petForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const petData = {
                ownerName: document.getElementById('ownerName').value,
                ownerPhone: document.getElementById('ownerPhone').value,
                shopName: document.getElementById('shopName').value,
                petName: document.getElementById('petName').value,
                petType: document.getElementById('petType').value,
                petBreed: document.getElementById('petBreed').value,
                petColor: document.getElementById('petColor').value,
                rabiesVaccine: document.getElementById('rabiesVaccine').value,
                vaccineDate: document.getElementById('vaccineDate').value,
                vaccineLocation: document.getElementById('vaccineLocation').value,
                otherVaccines: document.getElementById('otherVaccines').value,
                petDescription: document.getElementById('petDescription').value,
                petPhoto: currentPetPhoto // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
            };
            
            addPet(petData);
            this.reset();
            removePhoto(); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏ß‡∏¢
            
            // Show success message
            const button = this.querySelector('button[type="submit"]');
            const originalText = button.innerHTML;
            button.innerHTML = '<span class="flex items-center justify-center"><span class="mr-2">üéâ</span>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!</span>';
            button.classList.add('from-green-500', 'to-green-600');
            setTimeout(() => {
                button.innerHTML = originalText;
                button.classList.remove('from-green-500', 'to-green-600');
            }, 3000);
        });

        function showSetupModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto';
            modal.innerHTML = `
                <div class="bg-white rounded-3xl p-8 max-w-2xl w-full my-8 max-h-screen overflow-y-auto">
                    <div class="flex justify-between items-center mb-6 sticky top-0 bg-white pb-4 border-b">
                        <h2 class="text-2xl font-bold text-gray-800">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold hover:bg-gray-100 rounded-full w-8 h-8 flex items-center justify-center">&times;</button>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-xl">
                            <h3 class="font-bold text-blue-800 mb-2">üìã ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</h3>
                            <ol class="list-decimal list-inside space-y-2 text-sm text-blue-700">
                                <li><strong>‡∏™‡∏£‡πâ‡∏≤‡∏á Google Sheets:</strong> ‡πÄ‡∏õ‡∏¥‡∏î <a href="https://sheets.google.com" target="_blank" class="underline font-semibold">sheets.google.com</a> ‚Üí ‡∏Ñ‡∏•‡∏¥‡∏Å "+" ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà</li>
                                <li><strong>‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:</strong> ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà "Untitled spreadsheet" ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô "‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏´‡∏°‡∏≤‡πÅ‡∏°‡∏ß"</li>
                                <li><strong>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Sheet ID:</strong> ‡∏î‡∏π URL ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô docs.google.com/spreadsheets/d/<span class="bg-yellow-200 px-1 rounded">ID_‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ</span>/edit</li>
                                <li><strong>‡πÄ‡∏õ‡∏¥‡∏î Apps Script:</strong> ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ <a href="https://script.google.com" target="_blank" class="underline font-semibold">script.google.com</a></li>
                                <li><strong>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå:</strong> ‡∏Ñ‡∏•‡∏¥‡∏Å "New project" ‚Üí ‡∏•‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏≠‡∏Å‡∏´‡∏°‡∏î ‚Üí ‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÑ‡∏ß‡πâ</li>
                                <li><strong>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Sheet ID:</strong> ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô "YOUR_SHEET_ID" ‡πÄ‡∏õ‡πá‡∏ô ID ‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏°‡∏≤</li>
                                <li><strong>Deploy:</strong> ‡∏Ñ‡∏•‡∏¥‡∏Å "Deploy" ‚Üí "New deployment" ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å type ‡πÄ‡∏õ‡πá‡∏ô "Web app"</li>
                                <li><strong>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Permission:</strong> Execute as: "Me" ‡πÅ‡∏•‡∏∞ Who has access: "Anyone"</li>
                                <li><strong>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL:</strong> ‡∏´‡∏•‡∏±‡∏á Deploy ‡∏à‡∏∞‡πÑ‡∏î‡πâ Web app URL ‚Üí ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</li>
                            </ol>
                        </div>
                        
                        <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded-r-xl">
                            <h3 class="font-bold text-red-800 mb-2">üö® ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß‡∏ö‡πà‡∏≠‡∏¢:</h3>
                            <ul class="list-disc list-inside space-y-1 text-sm text-red-700">
                                <li>‡∏•‡∏∑‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô "YOUR_SHEET_ID" ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î Apps Script</li>
                                <li>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Permission ‡∏ú‡∏¥‡∏î (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô "Anyone" ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà "Only myself")</li>
                                <li>‡πÉ‡∏ä‡πâ URL ‡∏ú‡∏¥‡∏î (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô Web app URL ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà URL ‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå)</li>
                                <li>Google Sheets ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô Public ‡∏´‡∏£‡∏∑‡∏≠ Anyone with link</li>
                                <li>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏î "Deploy" ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î "Deploy" ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡πÉ‡∏´‡∏°‡πà</li>
                            </ul>
                        </div>
                        
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-xl">
                            <h3 class="font-bold text-yellow-800 mb-2">üìù Google Apps Script Code (‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ):</h3>
                            <textarea readonly class="w-full h-40 p-3 bg-gray-100 rounded-lg text-xs font-mono" onclick="this.select()">function doPost(e) {
  try {
    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô YOUR_SHEET_ID ‡πÄ‡∏õ‡πá‡∏ô ID ‡∏Ç‡∏≠‡∏á Google Sheets ‡∏à‡∏£‡∏¥‡∏á
    const sheet = SpreadsheetApp.openById('YOUR_SHEET_ID').getActiveSheet();
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ header ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°
    if (sheet.getLastRow() === 0) {
      sheet.appendRow([
        '‡∏£‡∏´‡∏±‡∏™‡∏™‡∏±‡∏ï‡∏ß‡πå', '‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå', '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó', '‡∏™‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå', '‡∏™‡∏µ', 
        '‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£', '‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤', '‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏û‡∏¥‡∏©‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏ö‡πâ‡∏≤', 
        '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î', '‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ', '‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏©', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô'
      ]);
    }
    
    const data = JSON.parse(e.postData.contents);
    
    if (data.action === 'add') {
      const pet = data.data;
      sheet.appendRow([
        pet.id, pet.petName, pet.petType, pet.petBreed || '',
        pet.petColor || '', pet.ownerName, pet.ownerPhone,
        pet.shopName || '', pet.rabiesVaccine || '',
        pet.vaccineDate || '', pet.vaccineLocation || '',
        pet.otherVaccines || '', pet.petDescription || '',
        pet.registeredDate
      ]);
    }
    
    return ContentService.createTextOutput(JSON.stringify({success: true, message: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'}))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({success: false, error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet(e) {
  return ContentService.createTextOutput(JSON.stringify({status: 'Google Apps Script is working!'}))
    .setMimeType(ContentService.MimeType.JSON);
}</textarea>
                            <p class="text-xs text-yellow-700 mt-2">‚ö†Ô∏è <strong>‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</strong> ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô YOUR_SHEET_ID ‡πÄ‡∏õ‡πá‡∏ô ID ‡∏Ç‡∏≠‡∏á Google Sheets ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î!</p>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">üîó Google Apps Script URL:</label>
                                <input type="url" id="scriptUrl" placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec" 
                                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-0">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">üìä Google Sheets ID:</label>
                                <input type="text" id="sheetId" placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms" 
                                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-0">
                                <p class="text-xs text-gray-500 mt-1">‡∏´‡∏≤ ID ‡∏à‡∏≤‡∏Å URL ‡∏Ç‡∏≠‡∏á Google Sheets: https://docs.google.com/spreadsheets/d/<strong>ID_‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ</strong>/edit</p>
                            </div>
                        </div>
                        
                        <div class="flex space-x-4">
                            <button onclick="testConnection()" class="flex-1 bg-blue-500 text-white py-3 px-6 rounded-xl font-semibold hover:bg-blue-600 transition-colors">
                                üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                            </button>
                            <button onclick="saveGoogleSheetsConfig()" class="flex-1 bg-green-500 text-white py-3 px-6 rounded-xl font-semibold hover:bg-green-600 transition-colors">
                                üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                            </button>
                        </div>
                        
                        <div id="setupStatus" class="text-center" style="display: none;"></div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            const savedConfig = JSON.parse(localStorage.getItem('googleSheetsConfig') || '{}');
            if (savedConfig.scriptUrl) document.getElementById('scriptUrl').value = savedConfig.scriptUrl;
            if (savedConfig.sheetId) document.getElementById('sheetId').value = savedConfig.sheetId;
        }

        async function testConnection() {
            const scriptUrl = document.getElementById('scriptUrl').value.trim();
            const sheetId = document.getElementById('sheetId').value.trim();
            const statusDiv = document.getElementById('setupStatus');
            
            if (!scriptUrl || !sheetId) {
                statusDiv.innerHTML = '<div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg">‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å URL ‡πÅ‡∏•‡∏∞ Sheet ID ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</div>';
                statusDiv.style.display = 'block';
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö URL
            if (!scriptUrl.includes('script.google.com') || !scriptUrl.includes('/exec')) {
                statusDiv.innerHTML = '<div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg">‚ùå URL ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô Web app URL ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ /exec</div>';
                statusDiv.style.display = 'block';
                return;
            }
            
            statusDiv.innerHTML = '<div class="bg-blue-100 text-blue-700 px-4 py-2 rounded-lg">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</div>';
            statusDiv.style.display = 'block';
            
            try {
                // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ GET request ‡∏Å‡πà‡∏≠‡∏ô
                const getResponse = await fetch(scriptUrl + '?test=1', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (!getResponse.ok) {
                    throw new Error(`GET request failed: ${getResponse.status} - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Deploy ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Permission ‡πÄ‡∏õ‡πá‡∏ô "Anyone"`);
                }
                
                // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ POST request
                const testData = {
                    action: 'add',
                    data: {
                        id: 'TEST001',
                        petName: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
                        petType: '‡∏´‡∏°‡∏≤',
                        ownerName: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö',
                        ownerPhone: '000-000-0000',
                        registeredDate: new Date().toLocaleDateString('th-TH')
                    }
                };
                
                const postResponse = await fetch(scriptUrl, {
                    method: 'POST',
                    mode: 'cors',
                    headers: { 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                const result = await postResponse.json();
                
                if (postResponse.ok && result.success) {
                    statusDiv.innerHTML = '<div class="bg-green-100 text-green-700 px-4 py-2 rounded-lg">‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô<br><small>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô Google Sheets ‡πÅ‡∏•‡πâ‡∏ß</small></div>';
                } else {
                    throw new Error(result.error || `HTTP ${postResponse.status}`);
                }
                
            } catch (error) {
                let errorMessage = '‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ';
                
                if (error.message.includes('CORS')) {
                    errorMessage += '‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ "Who has access" ‡πÄ‡∏õ‡πá‡∏ô "Anyone"';
                } else if (error.message.includes('404')) {
                    errorMessage += '‡πÑ‡∏°‡πà‡∏û‡∏ö URL - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Deploy ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ Web app URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                } else if (error.message.includes('403')) {
                    errorMessage += '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Permission';
                } else if (error.message.includes('YOUR_SHEET_ID')) {
                    errorMessage += '‡∏•‡∏∑‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô YOUR_SHEET_ID ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î Apps Script';
                } else {
                    errorMessage += error.message;
                }
                
                statusDiv.innerHTML = `<div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg">${errorMessage}</div>`;
            }
        }

        function saveGoogleSheetsConfig() {
            const scriptUrl = document.getElementById('scriptUrl').value;
            const sheetId = document.getElementById('sheetId').value;
            const statusDiv = document.getElementById('setupStatus');
            
            if (!scriptUrl || !sheetId) {
                statusDiv.innerHTML = '<div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</div>';
                statusDiv.style.display = 'block';
                return;
            }
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
            const config = { scriptUrl, sheetId, enabled: true };
            localStorage.setItem('googleSheetsConfig', JSON.stringify(config));
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
            GOOGLE_SHEETS_CONFIG.scriptUrl = scriptUrl;
            GOOGLE_SHEETS_CONFIG.sheetId = sheetId;
            GOOGLE_SHEETS_CONFIG.enabled = true;
            
            statusDiv.innerHTML = '<div class="bg-green-100 text-green-700 px-4 py-2 rounded-lg">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>';
            statusDiv.style.display = 'block';
            
            updateConnectionStatus();
            
            // ‡∏õ‡∏¥‡∏î modal ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                document.querySelector('.fixed.inset-0').remove();
            }, 2000);
        }

        function showFirebaseSetupModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto';
            modal.innerHTML = `
                <div class="bg-white rounded-3xl p-8 max-w-3xl w-full my-8 max-h-screen overflow-y-auto">
                    <div class="flex justify-between items-center mb-6 sticky top-0 bg-white pb-4 border-b">
                        <h2 class="text-2xl font-bold text-gray-800">üî• ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase - ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏à‡∏ö!</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold hover:bg-gray-100 rounded-full w-8 h-8 flex items-center justify-center">&times;</button>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="bg-orange-50 border-l-4 border-orange-400 p-4 rounded-r-xl">
                            <h3 class="font-bold text-orange-800 mb-2">üöÄ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡πÄ‡∏û‡∏µ‡∏¢‡∏á 5 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:</h3>
                            <ol class="list-decimal list-inside space-y-2 text-sm text-orange-700">
                                <li><strong>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå:</strong> ‡πÄ‡∏õ‡∏¥‡∏î <a href="https://console.firebase.google.com" target="_blank" class="underline font-semibold">Firebase Console</a> ‚Üí ‡∏Ñ‡∏•‡∏¥‡∏Å "Create a project" ‚Üí ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå</li>
                                <li><strong>‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ Firestore:</strong> ‡πÑ‡∏õ‡∏ó‡∏µ‡πà "Firestore Database" ‚Üí "Create database" ‚Üí "Start in test mode" ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å location</li>
                                <li><strong>‡πÄ‡∏û‡∏¥‡πà‡∏° Web App:</strong> ‡πÑ‡∏õ‡∏ó‡∏µ‡πà "Project settings" (‚öôÔ∏è) ‚Üí "Add app" ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Web (</>) ‚Üí ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ App</li>
                                <li><strong>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Config:</strong> ‡∏´‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á App ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô <code>const firebaseConfig = {...}</code> ‚Üí <strong>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</strong></li>
                                <li><strong>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Security Rules:</strong> ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firestore ‚Üí Rules ‚Üí ‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î Rules ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</li>
                            </ol>
                        </div>
                        
                        <div class="bg-green-50 border-l-4 border-green-400 p-4 rounded-r-xl">
                            <h3 class="font-bold text-green-800 mb-2">‚ú® ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ:</h3>
                            <div class="grid grid-cols-2 gap-2 text-sm text-green-700">
                                <div>‚Ä¢ Real-time Sync ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</div>
                                <div>‚Ä¢ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</div>
                                <div>‚Ä¢ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
                                <div>‚Ä¢ ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Cloud</div>
                                <div>‚Ä¢ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</div>
                                <div>‚Ä¢ ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡πá‡∏ß‡∏à‡∏≤‡∏Å Cache</div>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-lg font-bold text-gray-800 mb-3">üìã ‡∏ß‡∏≤‡∏á Firebase Config ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà:</label>
                                
                                <!-- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ -->
                                <div class="bg-gray-50 p-4 rounded-lg mb-3 space-y-3">
                                    <p class="text-sm font-semibold text-gray-700">‚úÖ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ):</p>
                                    
                                    <div class="bg-white p-3 rounded border-l-4 border-green-400">
                                        <p class="text-xs font-semibold text-green-700 mb-1">‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 1: ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏ö‡∏•‡πá‡∏≠‡∏Å</p>
                                        <code class="text-xs text-gray-600 block">
                                            const firebaseConfig = {<br>
                                            &nbsp;&nbsp;apiKey: "AIzaSyC...",<br>
                                            &nbsp;&nbsp;authDomain: "project.firebaseapp.com",<br>
                                            &nbsp;&nbsp;projectId: "project-id",<br>
                                            &nbsp;&nbsp;storageBucket: "project.appspot.com",<br>
                                            &nbsp;&nbsp;messagingSenderId: "123456789",<br>
                                            &nbsp;&nbsp;appId: "1:123:web:abc123"<br>
                                            };
                                        </code>
                                    </div>
                                    
                                    <div class="bg-white p-3 rounded border-l-4 border-blue-400">
                                        <p class="text-xs font-semibold text-blue-700 mb-1">‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ object</p>
                                        <code class="text-xs text-gray-600 block">
                                            {<br>
                                            &nbsp;&nbsp;apiKey: "AIzaSyC...",<br>
                                            &nbsp;&nbsp;authDomain: "project.firebaseapp.com",<br>
                                            &nbsp;&nbsp;projectId: "project-id",<br>
                                            &nbsp;&nbsp;storageBucket: "project.appspot.com",<br>
                                            &nbsp;&nbsp;messagingSenderId: "123456789",<br>
                                            &nbsp;&nbsp;appId: "1:123:web:abc123"<br>
                                            }
                                        </code>
                                    </div>
                                    
                                    <div class="bg-white p-3 rounded border-l-4 border-purple-400">
                                        <p class="text-xs font-semibold text-purple-700 mb-1">‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 3: ‡πÅ‡∏¢‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î</p>
                                        <code class="text-xs text-gray-600 block">
                                            apiKey: "AIzaSyC..."<br>
                                            authDomain: "project.firebaseapp.com"<br>
                                            projectId: "project-id"<br>
                                            storageBucket: "project.appspot.com"<br>
                                            messagingSenderId: "123456789"<br>
                                            appId: "1:123:web:abc123"
                                        </code>
                                    </div>
                                </div>
                                
                                <textarea id="firebaseConfigText" rows="10" 
                                          placeholder="‡∏ß‡∏≤‡∏á Firebase Config ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
const firebaseConfig = {
  apiKey: &quot;AIzaSyC...&quot;,
  authDomain: &quot;project.firebaseapp.com&quot;,
  projectId: &quot;project-id&quot;,
  storageBucket: &quot;project.appspot.com&quot;,
  messagingSenderId: &quot;123456789&quot;,
  appId: &quot;1:123:web:abc123&quot;
};"
                                          class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-orange-500 focus:ring-0 text-sm font-mono resize-none"></textarea>
                                
                                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 rounded-r-lg">
                                    <p class="text-xs text-yellow-800">
                                        <strong>üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö:</strong> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Firebase Console ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ 
                                        ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏°‡πâ‡∏à‡∏∞‡∏°‡∏µ comment ‡∏´‡∏£‡∏∑‡∏≠ code ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏õ‡∏ô‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-xl">
                            <h3 class="font-bold text-yellow-800 mb-2">üîí Security Rules (‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô Firestore Rules):</h3>
                            <textarea readonly class="w-full h-32 p-3 bg-gray-100 rounded-lg text-xs font-mono" onclick="this.select()">rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô-‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á
    match /pets/{petId} {
      allow read, write: if true;
    }
    
    // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
    match /_health/{document} {
      allow read, write: if true;
    }
    
    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ
    match /{document=**} {
      allow read, write: if false;
    }
  }
}</textarea>
                            <p class="text-xs text-yellow-700 mt-2">üõ°Ô∏è <strong>‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢:</strong> Rules ‡∏ô‡∏µ‡πâ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
                        </div>
                        
                        <div class="flex space-x-4">
                            <button onclick="parseAndTestFirebaseConfig()" class="flex-1 bg-orange-500 text-white py-3 px-6 rounded-xl font-semibold hover:bg-orange-600 transition-colors">
                                üß™ ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• + ‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                            </button>
                            <button onclick="saveFirebaseConfigFromText()" class="flex-1 bg-green-500 text-white py-3 px-6 rounded-xl font-semibold hover:bg-green-600 transition-colors">
                                üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                            </button>
                            <button onclick="loadFirebaseData()" class="flex-1 bg-blue-500 text-white py-3 px-6 rounded-xl font-semibold hover:bg-blue-600 transition-colors">
                                üì• ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            </button>
                        </div>
                        
                        <div id="firebaseSetupStatus" class="text-center" style="display: none;"></div>
                        
                        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡πÑ‡∏î‡πâ -->
                        <div id="parsedConfig" class="hidden bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-xl">
                            <h3 class="font-bold text-blue-800 mb-2">üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡πÑ‡∏î‡πâ:</h3>
                            <div id="configDetails" class="text-sm text-blue-700 space-y-1"></div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            const savedConfig = JSON.parse(localStorage.getItem('firebaseConfig') || '{}');
            if (savedConfig.apiKey) {
                const configText = `const firebaseConfig = {
  apiKey: "${savedConfig.apiKey}",
  authDomain: "${savedConfig.authDomain}",
  projectId: "${savedConfig.projectId}",
  storageBucket: "${savedConfig.storageBucket}",
  messagingSenderId: "${savedConfig.messagingSenderId}",
  appId: "${savedConfig.appId}"
};`;
                document.getElementById('firebaseConfigText').value = configText;
            }
        }

        function parseFirebaseConfig(configText) {
            try {
                console.log('Parsing config text:', configText.substring(0, 100) + '...');
                
                // ‡∏•‡∏ö comment ‡πÅ‡∏•‡∏∞ whitespace ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
                let cleanText = configText.replace(/\/\*[\s\S]*?\*\//g, '').replace(/\/\/.*$/gm, '');
                
                // ‡∏•‡∏≠‡∏á‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ
                let config = null;
                
                // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏´‡∏≤ JSON object ‡πÉ‡∏ô text
                let jsonMatch = cleanText.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    let jsonStr = jsonMatch[0];
                    
                    try {
                        // ‡πÅ‡∏õ‡∏•‡∏á JavaScript object notation ‡πÄ‡∏õ‡πá‡∏ô JSON
                        jsonStr = jsonStr
                            .replace(/(\w+)\s*:/g, '"$1":')  // ‡πÄ‡∏û‡∏¥‡πà‡∏° quotes ‡∏£‡∏≠‡∏ö keys
                            .replace(/'/g, '"')              // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô single quotes ‡πÄ‡∏õ‡πá‡∏ô double quotes
                            .replace(/,(\s*[}\]])/g, '$1')   // ‡∏•‡∏ö trailing commas
                            .replace(/\n/g, ' ')             // ‡∏•‡∏ö newlines
                            .replace(/\s+/g, ' ');           // ‡∏•‡∏î whitespace
                        
                        config = JSON.parse(jsonStr);
                    } catch (e) {
                        console.log('JSON parse failed, trying alternative method');
                    }
                }
                
                // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÉ‡∏ä‡πâ regex ‡πÅ‡∏¢‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞ field
                if (!config) {
                    config = {};
                    
                    const patterns = {
                        apiKey: /apiKey\s*:\s*["']([^"']+)["']/,
                        authDomain: /authDomain\s*:\s*["']([^"']+)["']/,
                        projectId: /projectId\s*:\s*["']([^"']+)["']/,
                        storageBucket: /storageBucket\s*:\s*["']([^"']+)["']/,
                        messagingSenderId: /messagingSenderId\s*:\s*["']([^"']+)["']/,
                        appId: /appId\s*:\s*["']([^"']+)["']/
                    };
                    
                    for (const [key, pattern] of Object.entries(patterns)) {
                        const match = cleanText.match(pattern);
                        if (match) {
                            config[key] = match[1];
                        }
                    }
                }
                
                // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 3: ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ eval (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏õ‡πá‡∏ô config ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
                if (!config || Object.keys(config).length === 0) {
                    try {
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á sandbox ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö eval
                        const sandbox = {
                            const: undefined,
                            firebaseConfig: undefined
                        };
                        
                        // ‡∏•‡∏≠‡∏á‡∏£‡∏±‡∏ô code ‡πÉ‡∏ô sandbox
                        const func = new Function('sandbox', `
                            with(sandbox) {
                                ${cleanText}
                                return typeof firebaseConfig !== 'undefined' ? firebaseConfig : null;
                            }
                        `);
                        
                        const result = func(sandbox);
                        if (result && typeof result === 'object') {
                            config = result;
                        }
                    } catch (e) {
                        console.log('Eval method failed:', e.message);
                    }
                }
                
                if (!config || Object.keys(config).length === 0) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Firebase config ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
                }
                
                console.log('Parsed config:', config);
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ required fields
                const requiredFields = ['apiKey', 'projectId', 'appId'];
                const missingFields = requiredFields.filter(field => !config[field]);
                
                if (missingFields.length > 0) {
                    throw new Error(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô: ${missingFields.join(', ')}`);
                }
                
                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö optional fields
                if (!config.authDomain && config.projectId) {
                    config.authDomain = `${config.projectId}.firebaseapp.com`;
                }
                if (!config.storageBucket && config.projectId) {
                    config.storageBucket = `${config.projectId}.appspot.com`;
                }
                
                return config;
            } catch (error) {
                console.error('Parse error:', error);
                throw new Error(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Firebase config ‡πÑ‡∏î‡πâ: ${error.message}`);
            }
        }

        function parseAndTestFirebaseConfig() {
            const configText = document.getElementById('firebaseConfigText').value.trim();
            const statusDiv = document.getElementById('firebaseSetupStatus');
            const parsedDiv = document.getElementById('parsedConfig');
            const detailsDiv = document.getElementById('configDetails');
            
            if (!configText) {
                statusDiv.innerHTML = '<div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg">‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á Firebase config ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</div>';
                statusDiv.style.display = 'block';
                return;
            }
            
            try {
                // ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• config
                const config = parseFirebaseConfig(configText);
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡πÑ‡∏î‡πâ
                detailsDiv.innerHTML = `
                    <div><strong>üîë API Key:</strong> ${config.apiKey.substring(0, 20)}...</div>
                    <div><strong>üåê Auth Domain:</strong> ${config.authDomain}</div>
                    <div><strong>üìÅ Project ID:</strong> ${config.projectId}</div>
                    <div><strong>üóÑÔ∏è Storage Bucket:</strong> ${config.storageBucket}</div>
                    <div><strong>üì® Messaging Sender ID:</strong> ${config.messagingSenderId || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</div>
                    <div><strong>üì± App ID:</strong> ${config.appId}</div>
                `;
                parsedDiv.classList.remove('hidden');
                
                // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                testFirebaseConnectionWithConfig(config);
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg">‚ùå ${error.message}</div>`;
                statusDiv.style.display = 'block';
                parsedDiv.classList.add('hidden');
            }
        }

        async function testFirebaseConnectionWithConfig(config) {
            const statusDiv = document.getElementById('firebaseSetupStatus');
            
            statusDiv.innerHTML = '<div class="bg-blue-100 text-blue-700 px-4 py-2 rounded-lg">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase...</div>';
            statusDiv.style.display = 'block';
            
            try {
                // ‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase
                const testApp = firebase.initializeApp(config, 'test-app-' + Date.now());
                const testFirestore = firebase.firestore(testApp);
                
                // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                await testFirestore.collection('_health').doc('connection-test').set({
                    message: 'Firebase connection test',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                const doc = await testFirestore.collection('_health').doc('connection-test').get();
                
                if (doc.exists) {
                    statusDiv.innerHTML = '<div class="bg-green-100 text-green-700 px-4 py-2 rounded-lg">‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô<br><small>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô Firestore ‡πÅ‡∏•‡πâ‡∏ß</small></div>';
                    
                    // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                    await testFirestore.collection('_health').doc('connection-test').delete();
                } else {
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                }
                
                // ‡∏•‡∏ö test app
                await testApp.delete();
                
            } catch (error) {
                let errorMessage = '‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ';
                
                if (error.code === 'permission-denied') {
                    errorMessage += '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Firestore Security Rules';
                } else if (error.code === 'invalid-api-key') {
                    errorMessage += 'API Key ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                } else if (error.code === 'project-not-found') {
                    errorMessage += '‡πÑ‡∏°‡πà‡∏û‡∏ö Project ID';
                } else {
                    errorMessage += error.message;
                }
                
                statusDiv.innerHTML = `<div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg">${errorMessage}</div>`;
            }
        }

        function saveFirebaseConfigFromText() {
            const configText = document.getElementById('firebaseConfigText').value.trim();
            const statusDiv = document.getElementById('firebaseSetupStatus');
            
            if (!configText) {
                statusDiv.innerHTML = '<div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg">‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á Firebase config ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</div>';
                statusDiv.style.display = 'block';
                return;
            }
            
            try {
                // ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• config
                const config = parseFirebaseConfig(configText);
                config.enabled = true;
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                localStorage.setItem('firebaseConfig', JSON.stringify(config));
                
                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
                Object.assign(FIREBASE_CONFIG, config);
                
                // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase
                initializeFirebase().then(success => {
                    if (success) {
                        statusDiv.innerHTML = '<div class="bg-green-100 text-green-700 px-4 py-2 rounded-lg">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! Firebase ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>';
                        updateConnectionStatus();
                        
                        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ real-time listener
                        setupFirebaseListener();
                        
                        // ‡∏õ‡∏¥‡∏î modal ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                        setTimeout(() => {
                            document.querySelector('.fixed.inset-0').remove();
                        }, 2000);
                    } else {
                        statusDiv.innerHTML = '<div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase ‡πÑ‡∏î‡πâ</div>';
                    }
                    statusDiv.style.display = 'block';
                });
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg">‚ùå ${error.message}</div>`;
                statusDiv.style.display = 'block';
            }
        }



        async function loadFirebaseData() {
            if (!FIREBASE_CONFIG.enabled) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase ‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            const statusDiv = document.getElementById('firebaseSetupStatus');
            statusDiv.innerHTML = '<div class="bg-blue-100 text-blue-700 px-4 py-2 rounded-lg">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase...</div>';
            statusDiv.style.display = 'block';
            
            try {
                const firebasePets = await loadFromFirebase();
                
                if (firebasePets.length > 0) {
                    // ‡∏ú‡∏™‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase ‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
                    const localPetIds = pets.map(pet => pet.id);
                    const newPets = firebasePets.filter(pet => !localPetIds.includes(pet.id));
                    
                    pets = [...newPets, ...pets];
                    savePets();
                    renderPets();
                    updateTotalCount();
                    
                    statusDiv.innerHTML = `<div class="bg-green-100 text-green-700 px-4 py-2 rounded-lg">‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà ${newPets.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>`;
                } else {
                    statusDiv.innerHTML = '<div class="bg-yellow-100 text-yellow-700 px-4 py-2 rounded-lg">üì≠ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Firebase</div>';
                }
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg">‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}</div>`;
            }
        }

        // Show full image modal
        function showFullImage(imageSrc, petName) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="relative max-w-4xl max-h-full">
                    <img src="${imageSrc}" alt="${petName}" 
                         class="max-w-full max-h-full object-contain rounded-2xl shadow-2xl">
                    <button onclick="this.closest('.fixed').remove()" 
                            class="absolute top-4 right-4 bg-white bg-opacity-20 hover:bg-opacity-30 text-white rounded-full w-12 h-12 flex items-center justify-center text-2xl font-bold backdrop-blur-sm transition-all">
                        ‚úï
                    </button>
                    <div class="absolute bottom-4 left-4 bg-black bg-opacity-50 text-white px-4 py-2 rounded-xl backdrop-blur-sm">
                        <div class="font-semibold">${petName}</div>
                    </div>
                </div>
            `;
            
            // ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            document.body.appendChild(modal);
        }

        // Event Listeners
        document.getElementById('searchInput').addEventListener('input', filterPets);
        document.getElementById('typeFilter').addEventListener('change', filterPets);
        document.getElementById('exportBtn').addEventListener('click', exportToExcel);
        document.getElementById('setupBtn').addEventListener('click', showSetupModal);
        document.getElementById('firebaseBtn').addEventListener('click', showFirebaseSetupModal);

        // Initialize - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
        async function initializeApp() {
            console.log('Initializing Pet Registration System...');
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets
            const savedGoogleConfig = JSON.parse(localStorage.getItem('googleSheetsConfig') || '{}');
            if (savedGoogleConfig.enabled) {
                GOOGLE_SHEETS_CONFIG.scriptUrl = savedGoogleConfig.scriptUrl;
                GOOGLE_SHEETS_CONFIG.sheetId = savedGoogleConfig.sheetId;
                GOOGLE_SHEETS_CONFIG.enabled = true;
                console.log('Google Sheets config loaded');
            }
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase
            const savedFirebaseConfig = JSON.parse(localStorage.getItem('firebaseConfig') || '{}');
            if (savedFirebaseConfig.enabled) {
                Object.assign(FIREBASE_CONFIG, savedFirebaseConfig);
                console.log('Firebase config loaded, initializing...');
                
                // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase ‡πÅ‡∏ö‡∏ö async
                initializeFirebase().then(success => {
                    if (success) {
                        console.log('Firebase initialized successfully');
                        updateConnectionStatus();
                        
                        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ real-time listener
                        setupFirebaseListener();
                        
                        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase
                        loadFromFirebase().then(firebasePets => {
                            if (firebasePets.length > 0) {
                                updateLocalDataFromFirebase(firebasePets);
                            }
                        }).catch(error => {
                            console.error('Failed to load Firebase data:', error);
                        });
                    } else {
                        console.warn('Firebase initialization failed');
                        updateConnectionStatus();
                    }
                }).catch(error => {
                    console.error('Firebase initialization error:', error);
                    updateConnectionStatus();
                });
            }
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI
            updateConnectionStatus();
            renderPets();
            updateTotalCount();
            
            // ‡∏•‡∏≠‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö Google Sheets
            if (GOOGLE_SHEETS_CONFIG.enabled && isOnline) {
                setTimeout(syncWithGoogleSheets, 1000);
            }
            
            console.log('App initialization completed');
        }

        // Cleanup function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
        function cleanup() {
            if (window.firebaseUnsubscribe) {
                window.firebaseUnsubscribe();
                console.log('Firebase listener unsubscribed');
            }
        }

        // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        window.addEventListener('beforeunload', cleanup);

        initializeApp();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96ef39f1933913b2',t:'MTc1NTE2MTY1NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
