<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏¥‡∏ß‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á - ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e5e7eb;
        }
        .calendar-day {
            background-color: white;
            min-height: 120px;
            padding: 8px;
            position: relative;
        }
        .task-item {
            font-size: 11px;
            padding: 2px 4px;
            margin: 1px 0;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .task-item:hover {
            transform: scale(1.02);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .priority-high { background-color: #fecaca; border-left: 3px solid #ef4444; }
        .priority-medium { background-color: #fed7aa; border-left: 3px solid #f97316; }
        .priority-low { background-color: #dcfce7; border-left: 3px solid #22c55e; }
        .status-pending { opacity: 1; }
        .status-progress { opacity: 0.8; background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,.1) 10px, rgba(255,255,255,.1) 20px); }
        .status-completed { opacity: 0.6; text-decoration: line-through; }
        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .sync-online { background-color: #10b981; color: white; }
        .sync-offline { background-color: #ef4444; color: white; }
        .sync-syncing { background-color: #f59e0b; color: white; animation: pulse 1s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-full">
    <!-- Sync Status Indicator -->
    <div id="syncIndicator" class="sync-indicator sync-offline">
        üî¥ ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå
    </div>

    <div class="container mx-auto p-6 max-w-7xl">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏¥‡∏ß‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á - ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>
            
            <!-- Controls -->
            <div class="flex flex-wrap gap-4 items-center justify-between">
                <div class="flex gap-4 items-center">
                    <button id="prevMonth" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                        ‚Üê ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô
                    </button>
                    <h2 id="currentMonth" class="text-xl font-semibold text-gray-700"></h2>
                    <button id="nextMonth" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                        ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí
                    </button>
                </div>
                
                <div class="flex gap-2">
                    <button id="addTaskBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                        ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô
                    </button>
                    <button id="forceSyncBtn" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition-colors">
                        üîÑ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                    </button>
                    <button id="exportBtn" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                        üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </button>
                </div>
            </div>
        </div>

        <!-- Calendar -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <!-- Days Header -->
            <div class="calendar-grid bg-gray-100 text-center font-semibold text-gray-700">
                <div class="p-4 border-r border-gray-200">‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</div>
                <div class="p-4 border-r border-gray-200">‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</div>
                <div class="p-4 border-r border-gray-200">‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</div>
                <div class="p-4 border-r border-gray-200">‡∏û‡∏∏‡∏ò</div>
                <div class="p-4 border-r border-gray-200">‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</div>
                <div class="p-4 border-r border-gray-200">‡∏®‡∏∏‡∏Å‡∏£‡πå</div>
                <div class="p-4">‡πÄ‡∏™‡∏≤‡∏£‡πå</div>
            </div>
            
            <!-- Calendar Days -->
            <div id="calendarDays" class="calendar-grid"></div>
        </div>

        <!-- Task Summary -->
        <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-white rounded-lg shadow-md p-4">
                <h3 class="font-semibold text-gray-700 mb-2">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span>‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                        <span id="totalTasks" class="font-semibold">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£:</span>
                        <span id="pendingTasks" class="font-semibold text-orange-600">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß:</span>
                        <span id="completedTasks" class="font-semibold text-green-600">0</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-4">
                <h3 class="font-semibold text-gray-700 mb-2">üéØ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-red-200 border-l-4 border-red-500 rounded"></div>
                        <span>‡∏™‡∏π‡∏á</span>
                        <span id="highPriority" class="ml-auto font-semibold">0</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-orange-200 border-l-4 border-orange-500 rounded"></div>
                        <span>‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</span>
                        <span id="mediumPriority" class="ml-auto font-semibold">0</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-green-200 border-l-4 border-green-500 rounded"></div>
                        <span>‡∏ï‡πà‡∏≥</span>
                        <span id="lowPriority" class="ml-auto font-semibold">0</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-4">
                <h3 class="font-semibold text-gray-700 mb-2">üåê ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h3>
                <div class="space-y-2">
                    <input type="text" id="appsScriptUrl" placeholder="Google Apps Script URL" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                    <div class="flex items-center gap-2 text-sm">
                        <input type="checkbox" id="autoSync" class="rounded">
                        <label for="autoSync">‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</label>
                    </div>
                    <button id="testConnectionBtn" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-2 rounded-lg text-sm transition-colors mb-2">
                        üîç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                    </button>
                    <div class="flex gap-2">
                        <button id="syncToSheetBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg text-sm transition-colors">
                            üì§ ‡∏™‡πà‡∏á‡πÑ‡∏õ Sheet
                        </button>
                        <button id="syncFromSheetBtn" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg text-sm transition-colors">
                            üì• ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å Sheet
                        </button>
                    </div>
                    <button id="setupGuideBtn" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-2 rounded-lg text-sm transition-colors">
                        üìñ ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Setup Guide Modal -->
    <div id="setupGuideModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-5xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">üìñ ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script</h3>
                <button id="closeGuideBtn" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <div class="space-y-6">
                <div class="bg-green-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-green-800 mb-2">‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h4>
                    <p class="text-green-700 text-sm mb-2">‡πÉ‡∏ä‡πâ Google Apps Script ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                    <p class="text-green-700 text-sm"><strong>‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:</strong> ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</p>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">üöÄ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Apps Script</h4>
                        <ol class="space-y-2 text-sm">
                            <li class="flex gap-2">
                                <span class="bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">1</span>
                                <span>‡πÄ‡∏õ‡∏¥‡∏î <a href="https://script.google.com" target="_blank" class="text-blue-600 underline">script.google.com</a></span>
                            </li>
                            <li class="flex gap-2">
                                <span class="bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">2</span>
                                <span>‡∏Å‡∏î "New project"</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">3</span>
                                <span>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏õ‡∏ß‡∏≤‡∏á</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">4</span>
                                <span>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç SHEET_ID ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">5</span>
                                <span>‡∏Å‡∏î "Deploy" ‚Üí "New deployment"</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">6</span>
                                <span>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Web app" ‚Üí "Anyone" ‚Üí "Deploy"</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">7</span>
                                <span>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</span>
                            </li>
                        </ol>
                    </div>

                    <div>
                        <h4 class="font-semibold mb-3">üìã ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Google Sheets</h4>
                        <ol class="space-y-2 text-sm">
                            <li class="flex gap-2">
                                <span class="bg-green-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">1</span>
                                <span>‡∏™‡∏£‡πâ‡∏≤‡∏á Google Sheets ‡πÉ‡∏´‡∏°‡πà</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="bg-green-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">2</span>
                                <span>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Sheet ID ‡∏à‡∏≤‡∏Å URL</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="bg-green-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">3</span>
                                <span>‡πÉ‡∏™‡πà‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°, ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°, ‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô, ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î, ‡∏ä‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞, ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="bg-green-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">4</span>
                                <span>‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ "Anyone with the link" ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ "Edit" ‡πÑ‡∏î‡πâ</span>
                            </li>
                        </ol>
                    </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-3">üíª ‡πÇ‡∏Ñ‡πâ‡∏î Google Apps Script</h4>
                    <textarea readonly class="w-full h-64 p-3 border border-gray-300 rounded font-mono text-xs bg-white" onclick="this.select()">
// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç SHEET_ID ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Google Sheets ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
const SHEET_ID = 'YOUR_SHEET_ID_HERE';

function doPost(e) {
  try {
    // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á JSON ‡πÅ‡∏•‡∏∞ FormData
    let data;
    if (e.postData.type === 'application/x-www-form-urlencoded') {
      // FormData format
      const params = e.parameter;
      data = {
        action: params.action,
        tasks: params.tasks ? JSON.parse(params.tasks) : []
      };
    } else {
      // JSON format
      data = JSON.parse(e.postData.contents);
    }
    
    const sheet = SpreadsheetApp.openById(SHEET_ID).getActiveSheet();
    
    if (data.action === 'write') {
      // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤ (‡πÄ‡∏ß‡πâ‡∏ô‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á)
      const lastRow = sheet.getLastRow();
      if (lastRow > 1) {
        sheet.deleteRows(2, lastRow - 1);
      }
      
      // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
      if (data.tasks && data.tasks.length > 0) {
        const rows = data.tasks.map(task => [
          task.date,
          task.time || '',
          task.title,
          task.description || '',
          task.assignee || '',
          task.priority === 'high' ? '‡∏™‡∏π‡∏á' : task.priority === 'medium' ? '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' : '‡∏ï‡πà‡∏≥',
          task.status === 'pending' ? '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' : task.status === 'progress' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥' : '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß',
          task.dueDate || ''
        ]);
        
        sheet.getRange(2, 1, rows.length, 8).setValues(rows);
      }
      
      return ContentService.createTextOutput(JSON.stringify({
        success: true,
        message: `‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó ${data.tasks.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`
      })).setMimeType(ContentService.MimeType.JSON);
    }
    
    if (data.action === 'read') {
      const values = sheet.getDataRange().getValues();
      const headers = values[0];
      const rows = values.slice(1);
      
      const tasks = rows
        .filter(row => row[0] && row[2]) // ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô
        .map((row, index) => ({
          id: Date.now() + index,
          date: row[0] ? new Date(row[0]).toISOString().split('T')[0] : '',
          time: row[1] || '',
          title: row[2] || '',
          description: row[3] || '',
          assignee: row[4] || '',
          priority: row[5] === '‡∏™‡∏π‡∏á' ? 'high' : row[5] === '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' ? 'medium' : 'low',
          status: row[6] === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' ? 'pending' : row[6] === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥' ? 'progress' : 'completed',
          dueDate: row[7] ? new Date(row[7]).toISOString().split('T')[0] : '',
          createdAt: new Date().toISOString()
        }));
      
      return ContentService.createTextOutput(JSON.stringify({
        success: true,
        tasks: tasks
      })).setMimeType(ContentService.MimeType.JSON);
    }
    
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({
      success: false,
      error: error.toString()
    })).setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet(e) {
  return ContentService.createTextOutput(JSON.stringify({
    success: true,
    message: 'Google Apps Script ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!'
  })).setMimeType(ContentService.MimeType.JSON);
}
                    </textarea>
                    <p class="text-xs text-gray-600 mt-2">üí° ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-blue-800 mb-2">üéØ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤ Sheet ID</h4>
                    <p class="text-blue-700 text-sm mb-2">‡∏à‡∏≤‡∏Å URL ‡∏Ç‡∏≠‡∏á Google Sheets:</p>
                    <code class="bg-white p-2 rounded text-xs block">
                        https://docs.google.com/spreadsheets/d/<span class="bg-yellow-200">1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms</span>/edit
                    </code>
                    <p class="text-blue-700 text-sm mt-2">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏Ñ‡∏∑‡∏≠ Sheet ID</p>
                </div>

                <div class="bg-yellow-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-yellow-800 mb-2">‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á</h4>
                    <ul class="text-yellow-700 space-y-1 text-sm">
                        <li>‚Ä¢ Google Sheets ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ "Anyone with the link" ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ</li>
                        <li>‚Ä¢ Apps Script ‡∏ï‡πâ‡∏≠‡∏á Deploy ‡πÄ‡∏õ‡πá‡∏ô "Web app" ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ "Anyone" ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ</li>
                        <li>‚Ä¢ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Google Sheets</li>
                        <li>‚Ä¢ ‡∏´‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î Apps Script ‡∏ï‡πâ‡∏≠‡∏á Deploy ‡πÉ‡∏´‡∏°‡πà</li>
                    </ul>
                </div>

                <div class="bg-red-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-red-800 mb-2">üîß ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</h4>
                    <ul class="text-red-700 space-y-2 text-sm">
                        <li><strong>1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL:</strong> ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô URL ‡∏à‡∏≤‡∏Å Google Apps Script ‡∏ó‡∏µ‡πà Deploy ‡πÅ‡∏•‡πâ‡∏ß</li>
                        <li><strong>2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå:</strong> Apps Script ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ "Anyone" ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ</li>
                        <li><strong>3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠:</strong> ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠" ‡∏Å‡πà‡∏≠‡∏ô</li>
                        <li><strong>4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Sheet ID:</strong> ‡πÉ‡∏ô Apps Script ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà Sheet ID ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</li>
                        <li><strong>5. ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà:</strong> ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á Deploy Apps Script ‡πÉ‡∏´‡∏°‡πà</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div id="taskModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡∏≤‡∏ô</h3>
            
            <form id="taskForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô</label>
                    <input type="text" id="taskTitle" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                    <textarea id="taskDescription" rows="3" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
                        <input type="date" id="taskDate" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
                        <input type="time" id="taskTime" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à</label>
                    <input type="date" id="taskDueDate" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</label>
                        <select id="taskPriority" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="low">‡∏ï‡πà‡∏≥</option>
                            <option value="medium">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                            <option value="high">‡∏™‡∏π‡∏á</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                        <select id="taskStatus" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="pending">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="progress">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥</option>
                            <option value="completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</label>
                    <input type="text" id="taskAssignee" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div class="flex gap-3 pt-4">
                    <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg transition-colors">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button type="button" id="deleteTaskBtn" class="px-4 bg-red-500 hover:bg-red-600 text-white py-2 rounded-lg transition-colors hidden">
                        ‡∏•‡∏ö
                    </button>
                    <button type="button" id="cancelBtn" class="px-4 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg transition-colors">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        class TaskScheduler {
            constructor() {
                this.currentDate = new Date();
                this.tasks = JSON.parse(localStorage.getItem('schedulerTasks')) || [];
                this.currentEditingTask = null;
                this.syncStatus = 'offline';
                this.autoSyncEnabled = false;
                this.syncInterval = null;
                
                this.initializeElements();
                this.bindEvents();
                this.loadSavedConfig();
                this.renderCalendar();
                this.updateStats();
                this.updateSyncIndicator();
                this.startAutoSync();
            }
            
            initializeElements() {
                this.calendarDays = document.getElementById('calendarDays');
                this.currentMonthEl = document.getElementById('currentMonth');
                this.taskModal = document.getElementById('taskModal');
                this.taskForm = document.getElementById('taskForm');
                this.syncIndicator = document.getElementById('syncIndicator');
            }
            
            bindEvents() {
                // Navigation
                document.getElementById('prevMonth').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                    this.renderCalendar();
                });
                
                document.getElementById('nextMonth').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                    this.renderCalendar();
                });
                
                // Modal controls
                document.getElementById('addTaskBtn').addEventListener('click', () => this.openTaskModal());
                document.getElementById('cancelBtn').addEventListener('click', () => this.closeTaskModal());
                document.getElementById('deleteTaskBtn').addEventListener('click', () => this.deleteTask());
                
                // Form submission
                this.taskForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveTask();
                });
                
                // Sync controls
                document.getElementById('forceSyncBtn').addEventListener('click', () => this.forceSync());
                document.getElementById('exportBtn').addEventListener('click', () => this.exportData());
                document.getElementById('setupGuideBtn').addEventListener('click', () => this.openSetupGuide());
                document.getElementById('closeGuideBtn').addEventListener('click', () => this.closeSetupGuide());
                document.getElementById('testConnectionBtn').addEventListener('click', () => this.testConnection());
                document.getElementById('syncToSheetBtn').addEventListener('click', () => this.syncToSheet());
                document.getElementById('syncFromSheetBtn').addEventListener('click', () => this.syncFromSheet());
                
                // Auto sync toggle
                document.getElementById('autoSync').addEventListener('change', (e) => {
                    this.autoSyncEnabled = e.target.checked;
                    this.saveConfig();
                    if (this.autoSyncEnabled) {
                        this.startAutoSync();
                    } else {
                        this.stopAutoSync();
                    }
                });
                
                // Apps Script URL change
                document.getElementById('appsScriptUrl').addEventListener('change', () => {
                    this.saveConfig();
                });
                
                // Close modal on outside click
                this.taskModal.addEventListener('click', (e) => {
                    if (e.target === this.taskModal) this.closeTaskModal();
                });
            }
            
            renderCalendar() {
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();
                
                // Update month display
                const monthNames = [
                    '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                    '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
                ];
                this.currentMonthEl.textContent = `${monthNames[month]} ${year + 543}`;
                
                // Calculate calendar days
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());
                
                // Clear calendar
                this.calendarDays.innerHTML = '';
                
                // Generate calendar days
                for (let i = 0; i < 42; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);
                    
                    const dayEl = this.createDayElement(date, month);
                    this.calendarDays.appendChild(dayEl);
                }
            }
            
            createDayElement(date, currentMonth) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                
                const isCurrentMonth = date.getMonth() === currentMonth;
                const isToday = this.isToday(date);
                
                if (!isCurrentMonth) {
                    dayEl.classList.add('opacity-30');
                }
                
                if (isToday) {
                    dayEl.classList.add('bg-blue-50', 'border-2', 'border-blue-300');
                }
                
                // Day number
                const dayNumber = document.createElement('div');
                dayNumber.className = `text-sm font-semibold mb-1 ${isToday ? 'text-blue-600' : 'text-gray-700'}`;
                dayNumber.textContent = date.getDate();
                dayEl.appendChild(dayNumber);
                
                // Add tasks for this day
                const dayTasks = this.getTasksForDate(date);
                dayTasks.forEach(task => {
                    const taskEl = this.createTaskElement(task);
                    dayEl.appendChild(taskEl);
                });
                
                // Add click handler for adding tasks
                dayEl.addEventListener('click', (e) => {
                    if (e.target === dayEl || e.target === dayNumber) {
                        this.openTaskModal(date);
                    }
                });
                
                return dayEl;
            }
            
            createTaskElement(task) {
                const taskEl = document.createElement('div');
                taskEl.className = `task-item priority-${task.priority} status-${task.status}`;
                
                const time = task.time ? ` ${task.time}` : '';
                const dueDate = task.dueDate ? `üìÖ ${task.dueDate}` : '';
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && task.status !== 'completed';
                if (isOverdue) {
                    taskEl.classList.add('border-2', 'border-red-400');
                }
                
                taskEl.innerHTML = `
                    <div class="font-medium truncate">${task.title}</div>
                    ${time ? `<div class="text-xs opacity-75">‚è∞ ${time}</div>` : ''}
                    ${dueDate ? `<div class="text-xs opacity-75 ${isOverdue ? 'text-red-600 font-semibold' : ''}">${dueDate}</div>` : ''}
                    ${task.assignee ? `<div class="text-xs opacity-75">üë§ ${task.assignee}</div>` : ''}
                `;
                
                taskEl.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.editTask(task);
                });
                
                return taskEl;
            }
            
            getTasksForDate(date) {
                const dateStr = this.formatDate(date);
                return this.tasks.filter(task => task.date === dateStr);
            }
            
            isToday(date) {
                const today = new Date();
                return date.toDateString() === today.toDateString();
            }
            
            formatDate(date) {
                return date.toISOString().split('T')[0];
            }
            
            openTaskModal(date = null) {
                this.currentEditingTask = null;
                this.taskForm.reset();
                
                // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                const now = new Date();
                const currentDate = date ? this.formatDate(date) : this.formatDate(now);
                const currentTime = now.toTimeString().slice(0, 5); // HH:MM format
                
                document.getElementById('taskDate').value = currentDate;
                document.getElementById('taskTime').value = currentTime;
                
                document.getElementById('deleteTaskBtn').classList.add('hidden');
                this.taskModal.classList.remove('hidden');
                this.taskModal.classList.add('flex');
                
                // Focus on title input
                setTimeout(() => {
                    document.getElementById('taskTitle').focus();
                }, 100);
            }
            
            editTask(task) {
                this.currentEditingTask = task;
                
                // Populate form
                document.getElementById('taskTitle').value = task.title;
                document.getElementById('taskDescription').value = task.description || '';
                document.getElementById('taskDate').value = task.date;
                document.getElementById('taskTime').value = task.time || '';
                document.getElementById('taskPriority').value = task.priority;
                document.getElementById('taskStatus').value = task.status;
                document.getElementById('taskAssignee').value = task.assignee || '';
                document.getElementById('taskDueDate').value = task.dueDate || '';
                
                document.getElementById('deleteTaskBtn').classList.remove('hidden');
                this.taskModal.classList.remove('hidden');
                this.taskModal.classList.add('flex');
            }
            
            closeTaskModal() {
                this.taskModal.classList.add('hidden');
                this.taskModal.classList.remove('flex');
                this.currentEditingTask = null;
            }
            
            async saveTask() {
                const taskData = {
                    id: this.currentEditingTask ? this.currentEditingTask.id : Date.now(),
                    title: document.getElementById('taskTitle').value,
                    description: document.getElementById('taskDescription').value,
                    date: document.getElementById('taskDate').value,
                    time: document.getElementById('taskTime').value,
                    priority: document.getElementById('taskPriority').value,
                    status: document.getElementById('taskStatus').value,
                    assignee: document.getElementById('taskAssignee').value,
                    dueDate: document.getElementById('taskDueDate').value,
                    createdAt: this.currentEditingTask ? this.currentEditingTask.createdAt : new Date().toISOString()
                };
                
                if (this.currentEditingTask) {
                    // Update existing task
                    const index = this.tasks.findIndex(t => t.id === this.currentEditingTask.id);
                    this.tasks[index] = taskData;
                } else {
                    // Add new task
                    this.tasks.push(taskData);
                }
                
                this.saveTasks();
                this.renderCalendar();
                this.updateStats();
                this.closeTaskModal();
                
                // Auto sync if enabled
                if (this.autoSyncEnabled) {
                    await this.syncToSheet();
                }
            }
            
            async deleteTask() {
                if (this.currentEditingTask && confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                    this.tasks = this.tasks.filter(t => t.id !== this.currentEditingTask.id);
                    this.saveTasks();
                    this.renderCalendar();
                    this.updateStats();
                    this.closeTaskModal();
                    
                    // Auto sync if enabled
                    if (this.autoSyncEnabled) {
                        await this.syncToSheet();
                    }
                }
            }
            
            saveTasks() {
                localStorage.setItem('schedulerTasks', JSON.stringify(this.tasks));
            }
            
            updateStats() {
                const total = this.tasks.length;
                const pending = this.tasks.filter(t => t.status === 'pending').length;
                const completed = this.tasks.filter(t => t.status === 'completed').length;
                const high = this.tasks.filter(t => t.priority === 'high').length;
                const medium = this.tasks.filter(t => t.priority === 'medium').length;
                const low = this.tasks.filter(t => t.priority === 'low').length;
                
                document.getElementById('totalTasks').textContent = total;
                document.getElementById('pendingTasks').textContent = pending;
                document.getElementById('completedTasks').textContent = completed;
                document.getElementById('highPriority').textContent = high;
                document.getElementById('mediumPriority').textContent = medium;
                document.getElementById('lowPriority').textContent = low;
            }
            
            updateSyncIndicator() {
                const indicator = this.syncIndicator;
                indicator.className = 'sync-indicator';
                
                switch (this.syncStatus) {
                    case 'online':
                        indicator.classList.add('sync-online');
                        indicator.textContent = 'üü¢ ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå';
                        break;
                    case 'syncing':
                        indicator.classList.add('sync-syncing');
                        indicator.textContent = 'üü° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå...';
                        break;
                    default:
                        indicator.classList.add('sync-offline');
                        indicator.textContent = 'üî¥ ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå';
                }
            }
            
            async testConnection() {
                const url = document.getElementById('appsScriptUrl').value.trim();
                
                if (!url) {
                    this.showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Google Apps Script URL', 'warning');
                    return;
                }
                
                const testBtn = document.getElementById('testConnectionBtn');
                const originalText = testBtn.textContent;
                testBtn.textContent = 'üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...';
                testBtn.disabled = true;
                
                try {
                    this.syncStatus = 'syncing';
                    this.updateSyncIndicator();
                    
                    const response = await fetch(url, {
                        method: 'GET',
                        mode: 'cors'
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            this.syncStatus = 'online';
                            this.showMessage('‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'success');
                        } else {
                            throw new Error(data.error || '‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                        }
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                } catch (error) {
                    this.syncStatus = 'offline';
                    this.showMessage(`‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
                } finally {
                    this.updateSyncIndicator();
                    testBtn.textContent = originalText;
                    testBtn.disabled = false;
                }
            }
            
            async syncToSheet() {
                const url = document.getElementById('appsScriptUrl').value.trim();
                
                if (!url) {
                    this.showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Google Apps Script URL ‡∏Å‡πà‡∏≠‡∏ô', 'warning');
                    return;
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL format
                if (!url.includes('script.google.com') && !url.includes('script.googleusercontent.com')) {
                    this.showMessage('‚ùå URL ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ URL ‡∏à‡∏≤‡∏Å Google Apps Script', 'error');
                    return;
                }
                
                try {
                    this.syncStatus = 'syncing';
                    this.updateSyncIndicator();
                    
                    // ‡πÉ‡∏ä‡πâ FormData ‡πÅ‡∏ó‡∏ô JSON ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS
                    const formData = new FormData();
                    formData.append('action', 'write');
                    formData.append('tasks', JSON.stringify(this.tasks));
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        body: formData,
                        redirect: 'follow'
                    });
                    
                    if (response.ok) {
                        const text = await response.text();
                        try {
                            const data = JSON.parse(text);
                            if (data.success) {
                                this.syncStatus = 'online';
                                this.showMessage(`‚úÖ ${data.message || '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'}`, 'success');
                            } else {
                                throw new Error(data.error || '‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                            }
                        } catch (parseError) {
                            // ‡∏´‡∏≤‡∏Å response ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà JSON ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô HTML redirect
                            if (text.includes('Google') || text.includes('script')) {
                                this.syncStatus = 'online';
                                this.showMessage('‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å Google)', 'success');
                            } else {
                                throw new Error('‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î');
                            }
                        }
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                } catch (error) {
                    this.syncStatus = 'offline';
                    let errorMsg = error.message;
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á error
                    if (error.message.includes('CORS')) {
                        errorMsg += '\nüí° ‡∏•‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Apps Script ‡πÑ‡∏î‡πâ Deploy ‡πÄ‡∏õ‡πá‡∏ô "Web app" ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ "Anyone" ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ';
                    } else if (error.message.includes('Failed to fetch')) {
                        errorMsg += '\nüí° ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï';
                    }
                    
                    this.showMessage(`‚ùå ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${errorMsg}`, 'error');
                } finally {
                    this.updateSyncIndicator();
                }
            }
            
            async syncFromSheet() {
                const url = document.getElementById('appsScriptUrl').value.trim();
                
                if (!url) {
                    this.showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Google Apps Script URL ‡∏Å‡πà‡∏≠‡∏ô', 'warning');
                    return;
                }
                
                try {
                    this.syncStatus = 'syncing';
                    this.updateSyncIndicator();
                    
                    // ‡πÉ‡∏ä‡πâ FormData ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢
                    const formData = new FormData();
                    formData.append('action', 'read');
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        body: formData,
                        redirect: 'follow'
                    });
                    
                    if (response.ok) {
                        const text = await response.text();
                        try {
                            const data = JSON.parse(text);
                            if (data.success && data.tasks) {
                                this.tasks = data.tasks;
                                this.saveTasks();
                                this.renderCalendar();
                                this.updateStats();
                                this.syncStatus = 'online';
                                this.showMessage(`‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${data.tasks.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
                            } else {
                                throw new Error(data.error || '‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                            }
                        } catch (parseError) {
                            throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ');
                        }
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                } catch (error) {
                    this.syncStatus = 'offline';
                    let errorMsg = error.message;
                    
                    if (error.message.includes('Failed to fetch')) {
                        errorMsg += '\nüí° ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï';
                    }
                    
                    this.showMessage(`‚ùå ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${errorMsg}`, 'error');
                } finally {
                    this.updateSyncIndicator();
                }
            }
            
            async forceSync() {
                if (this.autoSyncEnabled) {
                    await this.syncToSheet();
                } else {
                    this.showMessage('‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡πà‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á‡πÑ‡∏õ Sheet', 'warning');
                }
            }
            
            startAutoSync() {
                if (this.autoSyncEnabled && !this.syncInterval) {
                    // ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                    this.syncInterval = setInterval(async () => {
                        if (this.syncStatus !== 'syncing') {
                            await this.syncToSheet();
                        }
                    }, 30000);
                }
            }
            
            stopAutoSync() {
                if (this.syncInterval) {
                    clearInterval(this.syncInterval);
                    this.syncInterval = null;
                }
            }
            
            exportData() {
                const csvContent = this.generateCSV();
                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                
                if (link.download !== undefined) {
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', `‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á_${new Date().toISOString().split('T')[0]}.csv`);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            }
            
            generateCSV() {
                const headers = ['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°', '‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°', '‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô', '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î', '‡∏ä‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', '‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à'];
                const rows = this.tasks.map(task => [
                    task.date,
                    task.time || '',
                    task.title,
                    task.description || '',
                    task.assignee || '',
                    task.priority === 'high' ? '‡∏™‡∏π‡∏á' : task.priority === 'medium' ? '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' : '‡∏ï‡πà‡∏≥',
                    task.status === 'pending' ? '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' : task.status === 'progress' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥' : '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß',
                    task.dueDate || ''
                ]);
                
                return [headers, ...rows].map(row => 
                    row.map(field => `"${field}"`).join(',')
                ).join('\n');
            }
            
            openSetupGuide() {
                document.getElementById('setupGuideModal').classList.remove('hidden');
                document.getElementById('setupGuideModal').classList.add('flex');
            }
            
            closeSetupGuide() {
                document.getElementById('setupGuideModal').classList.add('hidden');
                document.getElementById('setupGuideModal').classList.remove('flex');
            }
            
            saveConfig() {
                const config = {
                    appsScriptUrl: document.getElementById('appsScriptUrl').value,
                    autoSync: document.getElementById('autoSync').checked
                };
                localStorage.setItem('taskSchedulerConfig', JSON.stringify(config));
            }
            
            loadSavedConfig() {
                const saved = localStorage.getItem('taskSchedulerConfig');
                if (saved) {
                    const config = JSON.parse(saved);
                    document.getElementById('appsScriptUrl').value = config.appsScriptUrl || '';
                    document.getElementById('autoSync').checked = config.autoSync || false;
                    this.autoSyncEnabled = config.autoSync || false;
                }
            }
            
            showMessage(message, type = 'info') {
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á notification element
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md transition-all duration-300 transform translate-x-full`;
                
                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
                switch (type) {
                    case 'success':
                        notification.classList.add('bg-green-500', 'text-white');
                        break;
                    case 'warning':
                        notification.classList.add('bg-yellow-500', 'text-white');
                        break;
                    case 'error':
                        notification.classList.add('bg-red-500', 'text-white');
                        break;
                    default:
                        notification.classList.add('bg-blue-500', 'text-white');
                }
                
                notification.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="flex-1 text-sm">${message}</div>
                        <button class="text-white hover:text-gray-200 text-lg leading-none" onclick="this.parentElement.parentElement.remove()">√ó</button>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // ‡πÅ‡∏™‡∏î‡∏á notification
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                }, 100);
                
                // ‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }, 5000);
            }
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new TaskScheduler();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98dc9eec558ef8e6',t:'MTc2MDMzNTI3MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
